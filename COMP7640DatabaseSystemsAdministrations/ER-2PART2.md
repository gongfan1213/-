# 实体关系（ER）模型（第2部分）
## 回顾
### 实体和属性
|属性分类|示例|
|---|---|
|多值属性|公寓号（可能一个地址对应多个公寓号）|
|派生属性|年龄（可由出生日期推导得出）|
|普通属性|街道号、街道名、姓氏、名字、街道、身份证号（HKID）、城市、姓名、地址、州、邮编、电话号码、出生日期  |
|  | 个人（实体） |

## 大纲
- 关系集
- 关系集上的约束：一对一（1 - 1）、一对多（1 - m）、多对一（m - 1）、多对多（m - m）

## ER中的R：关系
- 关系描述了实体之间的联系。
- 关系示例：
    - 一个人拥有一只宠物。
    - 一个人购买了一张CD。
    - 一个人居住在某个地址。

## 什么是关系？
- 对于每一个唯一的实体组合，只能存在一种关系。这意味着关系由其相关实体的键唯一确定。
- 例如：“拥有（owns）”关系的键是{Person.HKID, Pet.ID}。

|身份证号（HKID）|姓名|地区|
|---|---|---|
|Alice|R133428(6)|九龙|
|Bob|P625228(4)|香港|
|Candy|A252242(7)|新界|

|宠物ID|宠物名字|
|---|---|
|1|Sam|
|2|Lady|
|3|Bear|

## 关系集
- 关系集捕获相同“类型”的关系。每个连接都是一种关系，所有连接的集合构成一个关系集。

## 带属性的关系
|身份证号（HKID）|宠物ID|宠物名字|主人姓名|地址|养宠起始时间|
|---|---|---|---|---|---|
|R133428(6)|1|Sam|Alice|九龙某地址|2020年1月|
|P625228(4)|2|Lady|Bob|香港某地址|2021年3月|
|A252242(7)|3|Bear|Candy|新界某地址|2022年5月|

## 问题1
根据以下信息绘制计算机科学（CS）数据库的ER图：
- 学生有学号（std - id）和姓名。
- 课程有课程代码（class - code）和课程名。
- 教授有教师编号（prof - id）和姓名。
- 一个学生可以注册多门课程。
- 一门课程可以被多个学生注册。
- 一门课程在特定时间和地点最多由一位教授授课（即没有联合授课情况）。
- 一位教授可以教授多门课程。

## 关系集上的约束
在上述例子中，一门课程最多由一位教授授课，而一位教授可以教授多门课程，这是一个一对多约束的例子。我们可以用一个箭头（一端指向“一”，多端指向“多”）来表示它。

## 关系集上的约束
- 每个关系集都与两种约束相关联：基数约束和参与约束。
- 这些约束为建模现实世界中的联系提供了强大的方式。

## 基数约束
基数约束施加在关系集上，有四种类型：一对一、一对多、多对一、多对多。

### 一对一（1 - 1）表示
一个客户最多可以借一笔贷款（0笔或1笔），一笔贷款最多可以被一个客户借走。

### 一对多（1 - m）表示
一个客户可以借多笔贷款（0笔或更多），一笔贷款最多可以被一个客户借走。

### 多对一（m - 1）表示
一个客户最多可以借一笔贷款，一笔贷款可以被多个客户共享。

### 多对多（m - m）表示
一个客户可以借多笔贷款，一笔贷款可以被多个客户共享。

## 问题2
根据以下信息绘制图书馆数据库的ER图：
- 每个用户有用户ID（user - id）、姓名和地址。
- 每本书有书ID（book - id）、书名（book - name）和出版商名称（publisher - name）。
- 每位作者有作者ID（author - id）和姓名。
- 每个用户可以借多本书。
- 每本书最多可以被一个用户借走。
- 每本书可以由多位作者撰写。
- 每位作者可以撰写多本书。

## 问题3
重复问题2，但条件改为：
- 每个用户最多可以借一本书。
- 每本书最多可以被一个用户借走。
- 每本书最多可以由一位作者撰写。
- 每位作者可以撰写多本书。

## 参与约束
在之前一对一基数约束的例子（如夫妻关系）中，一个男人/女人最多可以与一个女人/男人结婚，但也可以未婚。当我们允许未婚人士存在于“夫妻”关系中时，这种情况被称为部分参与（否则为全部参与）。

### 全部参与
实体集中的每个实体都必须至少参与一种关系。

### 部分参与
部分实体可能不参与关系。在ER图中，参与约束用加粗线条表示。

### 示例
从这个关系中的参与约束可以推断出：每个客户必须至少借一笔贷款，有些贷款可能没有被任何客户借走。

## 关于约束的更多内容
- 基数约束：一对一（1 - 1）、一对多（1 - m）、多对一（m - 1）、多对多（m - m）。
- 参与约束：部分参与、全部参与。这两种类型的约束相互独立，每种基数约束都可以与任何参与约束一起使用。

## 问题4
重复问题1，但条件改为：
- 学生可能不注册任何课程。
- 一门课程必须至少有20名学生。
- 教授可能不教授任何课程。
- 一门课程必须最多由一位教授授课。

## 问题5
重复问题2，但条件改为：
- 每个用户可能不借任何书。
- 每本书可能不被任何用户借走，或者最多被一个用户借走。
- 每本书必须至少由一位作者撰写。
- 每位作者必须至少撰写一本书。

## 问题6
在一所大学中，教授有员工ID（sid）、姓名和所在系别。每位教授可以雇佣多名研究助理。每个研究助理有员工ID（rid）、姓名和所参与的资助项目ID（pid）。每个研究助理必须由一位教授雇佣。绘制ER图来建模教授和研究助理之间的关系。

## 问题7
从以下关系中可以推断出什么？

## 关于ER图我们学到了什么？
- 实体集和属性。
- 关系集（一对一、一对多、多对一、多对多），全部/部分参与，以及关系集的属性。

## 问题1的答案

## 问题2的答案

## 问题3的答案

## 问题4的答案

## 问题5的答案

## 问题6的答案

## 问题7的答案
- 每个客户应该恰好借一笔贷款。
- 每笔贷款应该恰好被一个客户借走。 
