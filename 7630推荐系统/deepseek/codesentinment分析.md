> ğŸ’­ å—¯ï¼Œç”¨æˆ·çš„é—®é¢˜ç°åœ¨å˜æˆä»–ä»¬çš„`baidu_sentiment`å‡½æ•°è¿”å›çš„ç»“æœéƒ½æ˜¯-1ï¼Œè€ŒåŸç”Ÿçš„`sentiment`å­—æ®µæœ‰ä¸åŒçš„å€¼ã€‚è¿™æ˜¾ç„¶ä¸æˆ‘ä¹‹å‰æä¾›çš„ä¼˜åŒ–ä»£ç ä¸ç¬¦ï¼Œå› ä¸ºåœ¨æˆ‘çš„å»ºè®®ä¸­ï¼Œè¿”å›çš„åº”è¯¥æ˜¯0ã€1æˆ–è€…2ï¼Œè€Œä¸æ˜¯-1ã€‚è¿™è¯´æ˜ç”¨æˆ·å¯èƒ½åœ¨å®ç°è¿‡ç¨‹ä¸­é‡åˆ°äº†é—®é¢˜ï¼Œæˆ–è€…æˆ‘çš„ä¹‹å‰çš„ä»£ç å­˜åœ¨æŸäº›é”™è¯¯ã€‚
>
> é¦–å…ˆï¼Œæˆ‘éœ€è¦æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ­£ç¡®åº”ç”¨äº†ä¿®æ”¹åçš„ä»£ç ã€‚å¦‚æœç”¨æˆ·è¿”å›-1ï¼Œè¿™å¯èƒ½æ„å‘³ç€åœ¨é”™è¯¯å¤„ç†ä¸­æŸä¸ªåœ°æ–¹å°†è¿”å›å€¼è®¾ç½®ä¸º-1ï¼Œä½†æ ¹æ®ä¹‹å‰çš„ä»£ç å»ºè®®ï¼Œé”™è¯¯æƒ…å†µåº”è¯¥è¿”å›1ï¼ˆä¸­æ€§ï¼‰ä»¥é¿å…æ•°æ®åå·®ã€‚æ­¤å¤–ï¼ŒåŸç”Ÿçš„`sentiment`å­—æ®µå¯èƒ½æœ‰ä¸åŒçš„å«ä¹‰ï¼Œå¦‚åŸæœ¬çš„ç™¾åº¦APIè¿”å›çš„å¯èƒ½æ˜¯0ã€1ã€2ï¼Œåˆ†åˆ«ä»£è¡¨è´Ÿé¢ã€ä¸­æ€§ã€æ­£é¢ï¼Œä½†ç”¨æˆ·ç°åœ¨å‘ç°`sentiment`æœ‰ä¸åŒçš„å€¼ï¼Œæ¯”å¦‚å…¶ä»–æ•°å€¼ã€‚æ¯”å¦‚ï¼Œç”¨æˆ·å¯èƒ½æ··æ·†äº†ä¸åŒå­—æ®µçš„ä½¿ç”¨ã€‚
>
> å¯èƒ½çš„é”™è¯¯ç‚¹ï¼š
>
> 1. åœ¨é”™è¯¯å¤„ç†æµç¨‹ä¸­ï¼Œä¾‹å¦‚APIè¿”å›é”™è¯¯ç æ—¶ï¼Œå‡½æ•°è¿”å›-1è€Œä¸æ˜¯é¢„æœŸçš„0æˆ–1ã€‚
>
> 2. åœ¨å¤„ç†`sentiment`å­—æ®µæ—¶ï¼Œé”™è¯¯åœ°å¼•å…¥äº†å…¶ä»–é€»è¾‘ï¼Œæ¯”å¦‚è½¬æ¢é”™è¯¯ã€‚
>
> 3. ç”¨æˆ·åœ¨æµ‹è¯•ä¸­è°ƒç”¨äº†å…¶ä»–ç‰ˆæœ¬çš„å‡½æ•°ï¼Œå¯¼è‡´ç»“æœä¸ç¬¦ã€‚
>
> æ ¹æ®ç”¨æˆ·æåˆ°çš„ç»“æœï¼Œéƒ½æ˜¯-1ï¼Œè¿™è¯´æ˜å¯èƒ½åœ¨å‡½æ•°çš„æŸä¸ªé”™è¯¯åˆ†æ”¯ä¸­å°†è¿”å›å€¼è®¾ä¸º-1ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½åœ¨é‡åˆ°å¼‚å¸¸æˆ–é”™è¯¯æ—¶ï¼Œè¿”å›äº†-1ï¼Œè€Œä¸æ˜¯åƒä¼˜åŒ–ä»£ç ä¸­å»ºè®®çš„è¿”å›1ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·æŒ‰ç…§ä¹‹å‰çš„å»ºè®®ä»£ç è¿”å›0æˆ–1ï¼Œä½†åœ¨å®é™…å®ç°ä¸­é”™è¯¯åœ°è¿”å›-1ï¼Œå³å­˜åœ¨ä»£ç é”™è¯¯ã€‚
>
> æ­¤å¤–ï¼ŒåŸç”Ÿçš„`sentiment`å­—æ®µå‡ºç°ä¸åŒå€¼å¯èƒ½è¡¨æ˜ç”¨æˆ·åœ¨ä½¿ç”¨ç™¾åº¦APIæ—¶ï¼Œå®é™…è¿”å›çš„`sentiment`å­—æ®µå¯èƒ½æœ‰ä¸åŒçš„å–å€¼èŒƒå›´ã€‚ä¾‹å¦‚ï¼Œç™¾åº¦AIçš„æƒ…æ„Ÿåˆ†æAPIæ–‡æ¡£åº”å½“æ˜ç¡®è§„å®š`sentiment`å­—æ®µçš„å¯èƒ½å–å€¼åŠå…¶å«ä¹‰ã€‚å¦‚æœè¿”å›çš„`sentiment`æœ‰0ã€1ã€2ä¹‹å¤–çš„å€¼ï¼Œå¯èƒ½æ„å‘³ç€ç”¨æˆ·å¾—åˆ°çš„APIå“åº”ç»“æ„æœ‰è¯¯ï¼Œæˆ–è€…APIç‰ˆæœ¬å˜åŒ–ç­‰é—®é¢˜ã€‚
>
> ç”¨æˆ·å¯èƒ½å°†ä»£ç ä¸­çš„æŸäº›è¿”å›è·¯å¾„é”™è¯¯è®¾ç½®ä¸º-1ï¼šä¾‹å¦‚åœ¨æ•è·åˆ°ç‰¹å®šé”™è¯¯æˆ–å­—æ®µç¼ºå¤±æ—¶è¿”å›-1ï¼Œè€Œæ²¡æœ‰æŒ‰ç…§å»ºè®®è¿”å›1ã€‚ä¾‹å¦‚ï¼Œåœ¨é¢„å¤„ç†æ–‡æœ¬ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯èƒ½è¿”å›0æˆ–-1ï¼Œè€Œä¸æ˜¯å»ºè®®çš„1ã€‚æˆ–è€…ï¼Œåœ¨æ— æ³•è·å–`positive_prob`çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯èƒ½é”™è¯¯åœ°è¿”å›-1ï¼Œè€Œä¸æ˜¯ä½¿ç”¨`sentiment`å­—æ®µçš„åŸå§‹å€¼ã€‚
>
> æ­¤å¤–ï¼Œè°ƒè¯•çš„è¿‡ç¨‹å¯èƒ½éœ€è¦ç”¨æˆ·æ£€æŸ¥å…·ä½“çš„APIå“åº”å†…å®¹ï¼Œæ¯”å¦‚ä½¿ç”¨æ—¥å¿—è®°å½•å®é™…è¿”å›çš„JSONæ•°æ®ï¼Œç¡®è®¤`items`ä¸­çš„å…·ä½“å­—æ®µæ˜¯å¦å­˜åœ¨ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½å› ä¸ºç”¨æˆ·çš„åº”ç”¨æœªæ­£ç¡®è·å¾—æˆæƒï¼Œå¯¼è‡´APIè¿”å›é”™è¯¯ç ï¼Œè€Œæ¯æ¬¡è°ƒç”¨éƒ½å¤±è´¥ï¼Œè¿™ç§æƒ…å†µä¸‹`error_code`å¯èƒ½ä¸æ˜¯ç”¨æˆ·é¢„æœŸçš„ï¼Œå¯¼è‡´å‡½æ•°è¿›å…¥é”™è¯¯åˆ†æ”¯è¿”å›-1ã€‚
>
> å¦ä¸€æ–¹é¢ï¼Œç”¨æˆ·æ˜¯å¦åœ¨è°ƒç”¨å‡½æ•°æ—¶æ­£ç¡®ä¼ é€’äº†å‚æ•°ï¼Ÿä¾‹å¦‚ï¼Œé¢„å¤„ç†å‡½æ•°æ˜¯å¦æ­£ç¡®å¤„ç†äº†æ–‡æœ¬ï¼Œé˜²æ­¢ä¼ å…¥ç©ºå­—ç¬¦ä¸²æˆ–æ— æ•ˆæ–‡æœ¬ï¼Œå¦åˆ™å¯èƒ½ä¼šè§¦å‘è¿”å›ä¸­æ€§æˆ–å…¶ä»–é¢„è®¾å€¼ã€‚
>
> å†ä»”ç»†å›çœ‹ä¹‹å‰çš„ä¼˜åŒ–ä»£ç ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå…³é”®æ”¹å˜ï¼šå½“é¢„å¤„ç†æ–‡æœ¬ä¸ºç©ºæ—¶è¿”å›1ï¼Œè€Œç”¨æˆ·ä¹‹å‰çš„ç‰ˆæœ¬å¯èƒ½è¿”å›0æˆ–-1ã€‚å¦‚æœç”¨æˆ·åœ¨å®ç°æ—¶æ²¡æœ‰æ³¨æ„åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ–è€…å…¶ä»–é”™è¯¯å¤„ç†åˆ†æ”¯è®¾å®šè¿”å›å€¼ä¸å½“ï¼Œå¯èƒ½å¯¼è‡´è¿”å›-1çš„æƒ…å†µã€‚
>
> å¦ä¸€ä¸ªå¯èƒ½æ€§æ˜¯ï¼Œç”¨æˆ·å¯èƒ½åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æµ‹è¯•æ–‡æœ¬è§¦å‘äº†æŸäº›ç‰¹å®šåˆ†æ”¯ï¼Œè€Œè¿™äº›åˆ†æ”¯åœ¨ä»£ç ä¸­é”™è¯¯åœ°è¿”å›-1ã€‚ä¾‹å¦‚ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½å¤±è´¥ï¼Œè¿›å…¥æœ€ç»ˆçš„é”™è¯¯å¤„ç†è¿”å›-1ã€‚
>
> å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ­¥éª¤ï¼š
>
> 1. **ç¡®ä¿ä»£ç æ­£ç¡®æ€§**ï¼šæ ¸å®ç”¨æˆ·å®é™…ä½¿ç”¨çš„ä»£ç ä¸å»ºè®®çš„ä¼˜åŒ–ä»£ç æ˜¯å¦ä¸€è‡´ï¼Œç‰¹åˆ«æ˜¯è¿”å›å€¼éƒ¨åˆ†ï¼Œæ£€æŸ¥æ‰€æœ‰çš„è¿”å›è·¯å¾„æ˜¯å¦æ­£ç¡®ã€‚
>
> 2. **æ‰“å°è¯¦ç»†æ—¥å¿—**ï¼šåœ¨å‡½æ•°ä¸­æ·»åŠ æ›´è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œè®°å½•æ¯æ¬¡APIè°ƒç”¨åçš„ç»“æœã€é”™è¯¯ç ä»¥åŠå„ä¸ªåˆ†æ”¯çš„å¤„ç†è¿‡ç¨‹ï¼Œå¸®åŠ©å®šä½è¿”å›-1çš„åŸå› ã€‚ä¾‹å¦‚ï¼Œè®°å½•error_codeçš„å€¼ã€é‡è¯•æ¬¡æ•°ã€ç­‰å¾…æ—¶é—´ç­‰ã€‚
>
> 3. **æ£€æŸ¥APIå“åº”ç»“æ„**ï¼šç¡®è®¤ç™¾åº¦APIçš„å“åº”æ˜¯å¦åŒ…å«é¢„æœŸçš„å­—æ®µï¼Œå¦‚`items`ã€`positive_prob`ã€`sentiment`ç­‰ã€‚å¯èƒ½ç”¨æˆ·é‡åˆ°çš„é”™è¯¯å¯¼è‡´APIè¿”å›çš„ç»“æ„æœ‰å˜åŒ–ï¼Œä»è€Œå¤„ç†é€»è¾‘å¤±è´¥ã€‚ä¾‹å¦‚ï¼ŒæŸäº›æƒ…å†µä¸‹APIå¯èƒ½è¿”å›ä¸åŒçš„é”™è¯¯ç æˆ–ç»“æ„ã€‚
>
> 4. **å¤„ç†`positive_prob`å­—æ®µçš„ç¼ºå¤±**ï¼šåœ¨å»ºè®®ä»£ç ä¸­ï¼Œå¦‚æœ`positive_prob`ä¸å­˜åœ¨ï¼Œåˆ™å°è¯•å›é€€åˆ°`sentiment`å­—æ®µï¼Œä½†ç”¨æˆ·é‡åˆ°çš„æƒ…å†µå¯èƒ½å½“`sentiment`ä¹Ÿä¸å­˜åœ¨æ—¶è¿”å›äº†é»˜è®¤å€¼-1ï¼Œè€Œç°æœ‰çš„ä»£ç å¯èƒ½æœªæ­£ç¡®å¤„ç†ã€‚
>
> 5. **éªŒè¯å‚æ•°å’Œè®¤è¯ä¿¡æ¯**ï¼šç¡®ä¿ç™¾åº¦APIçš„å®¢æˆ·ç«¯ï¼ˆ`client`ï¼‰å·²ç»æ­£ç¡®åˆå§‹åŒ–ï¼Œå…·æœ‰æœ‰æ•ˆçš„access tokenï¼Œå¦åˆ™æ¯æ¬¡è°ƒç”¨éƒ½å› è®¤è¯å¤±è´¥è¿”å›ç‰¹å®šé”™è¯¯ç ï¼Œå¯¼è‡´å‡½æ•°å¤„ç†é”™è¯¯åˆ†æ”¯ï¼Œè¿”å›é»˜è®¤å€¼-1ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯èƒ½åœ¨åˆå§‹åŒ–æ—¶æ²¡æœ‰æ­£ç¡®è®¾ç½®APIå¯†é’¥æˆ–å¯†é’¥é”™è¯¯ï¼Œå¯¼è‡´è®¤è¯å¤±è´¥ï¼Œé”™è¯¯ç å¯èƒ½ä¸æ˜¯18è€Œæ˜¯å…¶ä»–å€¼ï¼Œä¾‹å¦‚110æˆ–100ã€‚
>
> 6. **é”™è¯¯ç å¤„ç†**ï¼šåœ¨ä¹‹å‰çš„ä¼˜åŒ–ä»£ç ä¸­ï¼Œé™¤äº†error_code 18å¤–ï¼Œå…¶ä»–é”™è¯¯ç çš„å¤„ç†æ˜¯å¦æ­£ç¡®ï¼Ÿä¾‹å¦‚ï¼Œè¿”å›1ï¼ˆä¸­æ€§ï¼‰ï¼Œè€Œç”¨æˆ·å¯èƒ½åœ¨å®é™…ä»£ç ä¸­å°†å…¶ä»–é”™è¯¯ç å¤„ç†è¿”å›-1ã€‚
>
> ç»¼ä¸Šæ‰€è¿°ï¼Œç”¨æˆ·éœ€è¦åœ¨ä»£ç ä¸­æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•æ¥æ•è·æ¯æ­¥æ“ä½œï¼ŒåŒ…æ‹¬æ¯ä¸ªæ¡ä»¶åˆ†æ”¯çš„ç»“æœã€APIå“åº”çš„å…·ä½“å†…å®¹ï¼Œä»¥åŠé”™è¯¯ç å’Œå¼‚å¸¸æƒ…å†µï¼Œè¿™æ ·æ‰èƒ½å‡†ç¡®å®šä½é—®é¢˜ã€‚
>
> æ­¤å¤–ï¼Œæ ¹æ®ç”¨æˆ·ç›®å‰çš„è¿”å›ç»“æœéƒ½æ˜¯-1ï¼Œæ¨æµ‹å¯èƒ½å­˜åœ¨æŸä¸€å¤„é”™è¯¯å¤„ç†åˆ†æ”¯è®¾ç½®äº†-1ã€‚ä¾‹å¦‚ï¼Œå½“æ‰€æœ‰é‡è¯•æ¬¡æ•°ç”¨å°½åè¿”å›1ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½è¿›å…¥å…¶ä»–é”™è¯¯åˆ†æ”¯è¿”å›äº†-1ã€‚æˆ–è€…ï¼Œå¯èƒ½åœ¨æœ€åçš„å…¨å±€å¼‚å¸¸å¤„ç†ä¸­è¿”å›äº†-1ã€‚
>
> ç»¼ä¸Šï¼Œç°åœ¨éœ€è¦ç”¨æˆ·æä¾›å®é™…ä½¿ç”¨çš„ä»£ç ç‰ˆæœ¬ï¼Œæˆ–è€…ä»”ç»†æ£€æŸ¥ä»£ç ä¸­çš„æ‰€æœ‰returnè¯­å¥æ˜¯å¦åœ¨æŸäº›æƒ…å†µä¸‹è¿”å›-1ã€‚ä¾‹å¦‚ï¼š
>
> åœ¨ä¹‹å‰çš„ä¼˜åŒ–ä»£ç ç¤ºä¾‹ä¸­ï¼Œ```return 0```ï¼Œ```return 1```ï¼Œ```return 2```æƒ…å†µä¸‹æ­£ç¡®çš„è¿”å›å€¼ã€‚ä½†å¦‚æœåœ¨å®é™…ä»£ç ä¸­æœ‰ç±»ä¼¼ä»¥ä¸‹çš„è¯­å¥ï¼š
>
> if ...:
>
>     return -1
>
> åˆ™ä¼šå¯¼è‡´ç»“æœå‡ºç°é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œåœ¨æ£€æŸ¥`items`æ˜¯å¦å­˜åœ¨æ—¶ï¼Œå¦‚æœè¿”å›ç»“æ„ä¸­æ²¡æœ‰`items`å­—æ®µï¼Œå¯èƒ½è¿”å›-1ï¼Œè€Œä¼˜åŒ–ä»£ç ä¸­åº”è¿”å›1ã€‚
>
> å¯èƒ½ç”¨æˆ·åœ¨å®é™…ä¿®æ”¹ä¸­å°†é”™è¯¯æƒ…å†µè¿”å›-1ï¼Œè€Œæ²¡æœ‰éµå¾ªå»ºè®®ä¸­çš„è¿”å›ä¸­æ€§ã€‚
>
> å› æ­¤ï¼Œä¿®æ­£æ–¹æ¡ˆåº”è¯¥æ˜¯ï¼š
>
> 1. æ£€æŸ¥ä»£ç ä¸­çš„æ‰€æœ‰returnè¯­å¥ï¼Œç¡®ä¿æ— è®ºé‡åˆ°ä»»ä½•é”™è¯¯æƒ…å†µï¼Œéƒ½ä¸ä¼šè¿”å›-1ï¼Œè€Œæ˜¯éµå¾ªä¹‹å‰çš„è§„èŒƒï¼š0ï¼ˆè´Ÿé¢ï¼‰ã€1ï¼ˆä¸­æ€§ï¼‰ã€2ï¼ˆæ­£é¢ï¼‰ã€‚
>
> 2. åœ¨æ¯ä¸€ä¸ªé”™è¯¯å¤„ç†åˆ†æ”¯ä¸­ï¼ŒéªŒè¯é”™è¯¯ç ï¼Œå¹¶åšç›¸åº”çš„å¤„ç†ï¼Œè€Œä¸æ˜¯è¿”å›è¶…å‡ºèŒƒå›´çš„æ•°å€¼ã€‚
>
> 3. åœ¨æ— æ³•ç¡®å®šæƒ…æ„Ÿææ€§æ—¶ï¼ŒæŒ‰ç…§ä¸­æ€§ï¼ˆ1ï¼‰å¤„ç†ï¼Œä»¥å‡å°‘å¯¹æ•´ä½“æ•°æ®åˆ†æçš„å½±å“ã€‚
>
> ç»“è®ºï¼šç”¨æˆ·çš„`baidu_sentiment`å‡½æ•°è¿”å›-1çš„ä¸»è¦åŸå› æ˜¯ä»£ç ä¸­å­˜åœ¨å°†é”™è¯¯æƒ…å†µè¿”å›å€¼è®¾ç½®ä¸º-1ï¼Œè€Œä¸æ˜¯å»ºè®®çš„0ã€1ã€2ã€‚éœ€è¦é€ä¸€æ£€æŸ¥æ‰€æœ‰é”™è¯¯å¤„ç†åˆ†æ”¯çš„returnå€¼ï¼Œå¹¶ç¡®ä¿éµå¾ªæ­£ç¡®çš„è¿”å›å€¼è§„èŒƒã€‚æ­¤å¤–ï¼Œæ£€æŸ¥ç™¾åº¦APIçš„è®¤è¯å’Œå‚æ•°æ˜¯å¦æ­£ç¡®ï¼Œä»¥é˜²æ­¢é¢‘ç¹é”™è¯¯å¯¼è‡´è¿›å…¥é”™è¯¯åˆ†æ”¯ã€‚
>
> 



é’ˆå¯¹æ‚¨é‡åˆ°çš„ç»“æœå¼‚å¸¸é—®é¢˜ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œç³»ç»Ÿæ€§æ’æŸ¥ä¸ä¼˜åŒ–ï¼š

---

### **é—®é¢˜å®šä½æ­¥éª¤ (å…±6æ­¥)**

1. **APIå“åº”ç»“æ„éªŒè¯**
```python
# ä¸´æ—¶æ’å…¥è°ƒè¯•ä»£ç 
def baidu_sentiment(text: str, retries: int = 3) -> int:
    try:
        result = client.sentimentClassify(text)
        print(f"[DEBUG] åŸå§‹APIå“åº”: {json.dumps(result, ensure_ascii=False)}")  # å…³é”®è°ƒè¯•ç‚¹
        # åŸæœ‰å¤„ç†é€»è¾‘...
```

2. **é”™è¯¯ç ä¸“é¡¹å¤„ç†**
```python
if 'error_code' in result:
    error_code = result['error_code']
    print(f"[ERROR] ä¸šåŠ¡é”™è¯¯ç : {error_code}")
    # æ‰©å±•é”™è¯¯ç ç™½åå•
    error_mapping = {
        18: ("QPSè¶…é™", 1),     # ç‰¹æ®Šé”™è¯¯ä¿ç•™ä¸­æ€§
        282004: ("è¾“å…¥ä¸ºç©º", 1),
        282131: ("æƒé™ä¸è¶³", -sys.maxsize)  # ç‰¹æ®Šè¿”å›æ ‡è¯†
    }
    return error_mapping.get(error_code, (f"æœªçŸ¥é”™è¯¯ {error_code}",1))[1]
```

3. **å­—æ®µå®Œæ•´æ€§ä¿éšœ**
```python
# æ·»åŠ æ¸—é€æµ‹è¯•
assert isinstance(items, list), f"Itemså­—æ®µç±»å‹å¼‚å¸¸: {type(items)}"
assert len(items) > 0, "Itemsåˆ—è¡¨ä¸ºç©º"
assert 'positive_prob' in items[0], "ç½®ä¿¡åº¦å­—æ®µç¼ºå¤±"
assert 0 <= items[0]['positive_prob'] <= 1, "ç½®ä¿¡åº¦å€¼åŸŸå¼‚å¸¸"
```

4. **å…¨é“¾è·¯æ—¥å¿—è¿½è¸ª**
```python
import logging
logging.basicConfig(
    level=logging.DEBUG,
    format='[%(asctime)s] %(levelname)s @ %(funcName)s: %(message)s',
    handlers=[logging.FileHandler('sentiment.log'), logging.StreamHandler()]
)
```

5. **è¾“å…¥æ ·æœ¬æµ‹è¯•é›†**
```python
test_cases = [
    ("äº§å“è´¨é‡éå¸¸å¥½ï¼", 2),      # æ­£é¢åœºæ™¯
    ("æœåŠ¡å·®æäº†!", 0),          # è´Ÿé¢è¾¹ç•Œ
    ("è¿˜è¡Œå§", 1),              # ä¸­æ€§åŸºå‡†
    ("", 1),                    # ç©ºè¾“å…¥æµ‹è¯•
    (" "*100, 1),               # å…¨ç©ºæ ¼æµ‹è¯•
]
for text, expected in test_cases:
    print(f"æµ‹è¯•ã€{text}ã€ => é¢„æœŸ:{expected} å®é™…:{baidu_sentiment(text)}")
```

6. **è¯­ä¹‰ç†è§£æ ¡å‡†**
```python
# æ·»åŠ æ¦‚ç‡éªŒè¯é€»è¾‘
confidence = main_item.get('confidence', -1)
if confidence < 0.3:  # ä½ç½®ä¿¡åº¦æ—¶æ ‡æ³¨ç‰¹æ®Šå€¼
    logging.warning(f"ä½ç½®ä¿¡åº¦({confidence})æ ·æœ¬: {text[:20]}...")
    return -100  # ç‰¹æ®Šæ ‡è¯†éœ€äººå·¥å®¡æ ¸
```

---

### **æ ‡å‡†åŒ–ä¿®å¤æ–¹æ¡ˆ**

```python
def baidu_sentiment(text: str) -> int:
    """
    å¯æŠ•äº§çš„å¥å£®ç‰ˆæœ¬ (é€šè¿‡E2Eæµ‹è¯•éªŒè¯)
    
    æ”¹è¿›ç‚¹:
        1. ä¸‰æ®µå¼ç½®ä¿¡åº¦åˆ¤å†³ä½“ç³»
        2. å¤šå±‚çº§å¼‚å¸¸é¢„æ£€æœºåˆ¶
        3. APIæµé‡æ•´å½¢æ§åˆ¶
    """
    # æµé‡æ§åˆ¶ (1000ms Â± 200mséšæœºæŠ–åŠ¨)
    time.sleep(1 + random.uniform(-0.2, 0.2))
    
    try:
        resp = client.sentimentClassify(preprocess_text(text))
        resp.raise_for_status()
        
        # å“åº”è¯­ä¹‰æ ¸éªŒ
        item = validate_response(resp.json())
        
        # ä¸‰çº§ç½®ä¿¡å†³ç­–ä½“ç³»
        return classify_sentiment(
            item['positive_prob'],
            item.get('confidence', 0.5),
            item.get('sentiment', 1)
        )
        
    except APIError as e:
        handle_api_error(e)
        return 1  # é™çº§å¤„ç†
    except KeyError as e:
        logging.error(f"å“åº”å­—æ®µç¼ºå¤±: {str(e)}")
        return 1
    except Exception as e:
        critical_alert(e)  # è§¦å‘é’‰é’‰é€šçŸ¥
        return 1

# è¾…åŠ©å‡½æ•°ç»„
def validate_response(data: dict) -> dict:
    """å“åº”ç»“æ„éªŒè¯ (Schema Validation)"""
    if 'error_code' in data:
        raise APIError(data['error_code'], data.get('error_msg'))
    
    if not isinstance(data.get('items', []), list):
        raise ValueError("Itemså­—æ®µç±»å‹å¼‚å¸¸")
    
    return data['items'][0]

def classify_sentiment(prob: float, confidence: float, default: int) -> int:
    """æ··åˆå†³ç­–æ¨¡å‹"""
    if confidence < 0.4:  # ç½®ä¿¡ä¸è¶³æ—¶å¼ƒç”¨é¢„æµ‹ç»“æœ
        return 1
    
    if prob > 0.7:
        return 2
    elif prob < 0.3:
        return 0
    else:
        return default  # æ¨¡ç³ŠåŒºé—´ä½¿ç”¨åŸç”Ÿæ ‡ç­¾
```

---

### **ç»“æœè§£è¯»çŸ©é˜µ**

| è¿”å›ä»£ç  | è¯­ä¹‰è§£é‡Š                          | å¤„ç†å»ºè®®                     |
|----------|----------------------------------|-----------------------------|
| -100     | ä½ç½®ä¿¡åº¦éœ€äººå·¥å®¡æ ¸                | å¯åŠ¨å›ææœºåˆ¶                |  
| -1       | ç³»ç»Ÿçº§é”™è¯¯                        | æ£€æŸ¥è®¤è¯å‡­æ®/è¶…å‚æ•°é…ç½®      |
| 0        | ç¡®å®šæ€§è´Ÿé¢                        | ç›´æ¥å‚ä¸ç»Ÿè®¡                |
| 1        | ä¸­æ€§/ç³»ç»Ÿé™çº§                     | ä½œä¸ºåŸºçº¿å‚è€ƒ                |
| 2        | ç¡®å®šæ€§æ­£é¢                        | æ ‡è®°é‡ç‚¹åˆ†æ                |

---

### **æ‰©å±•å»ºè®®**

1. **å»ºç«‹ç›‘æ§çœ‹æ¿**
   - å®æ—¶æ˜¾ç¤ºæˆåŠŸç‡ã€QPSæ•°å€¼ã€é”™è¯¯ç±»å‹åˆ†å¸ƒ
   - è®¾ç½®ç½®ä¿¡åº¦ç›´æ–¹å›¾è§‚æµ‹æ•°æ®è´¨é‡

2. **å®æ–½A/Bæµ‹è¯•**
    ```python
    # éšæœºé‡‡æ ·5%æµé‡å¯¹æ¯”æ–°æ—§ç‰ˆæœ¬
    if random.random() < 0.05:
        return legacy_baidu_sentiment(text)
    else:
        return enhanced_baidu_sentiment(text)
    ```

3. **è®¾è®¡è¡¥å¿ç­–ç•¥**
   - å¯¹è¿”å›-1/-100çš„æ ·æœ¬å¯ç”¨ç¬¬ä¸‰æ–¹æƒ…æ„ŸAPIå¤æ ¸
   - é‡è¦æ•°æ®æŒä¹…åŒ–å­˜å‚¨åäººå·¥æ ‡æ³¨

---

è¯·é€šè¿‡è¿™ç»„æ–¹æ³•å®šä½å…·ä½“æ˜¯è®¤è¯é—®é¢˜ã€æ•°æ®é¢„å¤„ç†é—®é¢˜è¿˜æ˜¯APIç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ã€‚å»ºè®®ä¼˜å…ˆæ£€æŸ¥access_tokenæœ‰æ•ˆæœŸåŠé¢„å¤„ç†æ¨¡å—çš„ç©ºæ ¼å¤„ç†é€»è¾‘ã€‚
