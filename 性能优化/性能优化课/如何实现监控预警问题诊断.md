# 性能平台搭建缺少监控预警的功能
借助noode-schedule做调度和定时任务的处理
通过node-mailer进行邮件报警
## 1.准备预警数据
做完数据清洗以后，一个分支使用spark做计算
另外一个分支使用flink实时数据计算
后者的数据是实时处理的
超过2s或者卡断的数据，直接标记位预警数据
## 2.借助node-schodeul
用一批定时任务将预警数据通过node.js拉去数据到mongoDB的预警表当中
## 3.预警的展示流程
根据预警的方式不同，样式展示页不同的
预警的方式有三种：
企业微信报警通知
邮件报警通知，短信报警通知
监控预警
性能标准是首屏时间1.5s秒开率位90%,超过这个标准就会再性能平台预警模块展示的
超出10%，会借助node-mailer做邮件预警
超出30%,会发短信报警通知
为了避免浪费资源，只需要对首屏页进行导航就可以了
预警g功能做好以后，前端性能平台就可以对重要的指标进行实时的监督
发现性能问题需要先对问题进行诊断
然后看情况需要进一步采取错误
先确认是否是共性问题（大量用户的数据的指标）还是个例问题
如果性能指标当中的首屏时间的均值出现异常，就是共性问题
天津用户反馈说发布页面的加载比较慢，他是怎么做的呢？
先看性能平台，发现再中国移动网络下发布页面的首屏时间均值很长，超过了3s说明是共共性问题
负责上传图片的js文件加载特别满，原因是他在资源加载的时候被阻塞住了，阻塞的是一个负责对图片上传后实时滤镜功能的文件
个例问题一般需要客服联系用户去解决，不需要代码层面去做什么事情
全量vs增量
同步vs异步
实时vs缓存
原片vs压缩
### 全量vs增量
指的是页面加载特别是列表页加载数据慢的情况
要从数据加载是全量还是增量的角度去诊断问题
首屏一般展示4条左右的商品数据
pc页首屏展示50条的商品数据，后端数据接口一般是同一套的
分接口先拉去首屏所需要的4条数据，然后再页面滚动或者下拉操作加载后续的数据就可以了
为了保证体验的流畅，有的时候我们会多加载几条数据，比如开始加载6条数据，港刚刚开始滚动到首屏结束的时候，第5条数据已经有了
### 同步vs异步
指的是遇到页面加载时间过程的情况，是不是因为接口同步加载导致的问题
电商app列表页一般需要先去拉去导航位置图片和连接信息然后去拉去商品列表的信息
可以考虑同时拉去两个列表，中间有依赖关系的地方集中到第一个接口去获取
### 实时vs缓存
指的是遇到接口数据或者静态资源加载过长的时候，要看以下是不是因为使用了实时数据的角度导致是否可以使用缓存的策略来解决这种问题
如果是能够缓存的数据，优先检查以下是否做了缓存的处理
如果用的是实时数据，要看一下是否会导致性能瓶颈
### 原片vs压缩
指的是当我们遇到图片加载缓慢的问题
可以查看以下图片是否是原图
做一些无损或者有损压缩处理，来提高加载速度，或者尽量不适用原始图片
# 如何评估项目的效果呢？
最好的方式就是通过性能优化，提高业务的数据指标
根据silled.co的数据展示，沃尔玛在线网站的页面加载时间每减少一秒，转化率增加2%
当前页面的首屏时间远远大于1s,如果首屏已经秒开，提升将非常有限的
用优化前后两个版本对比的方式，去看转化率指标的变化
也就是你经常听到的ab测试
# 前端数据可视化展示前台
以列表页性能优化的项目为例，在做性能优化之前，先把列表页面分成AB两个版本，这两个版本可以通过条件语句区分代码块，A版本是筛选向优化的，B版本是筛选项化以后的，用if条件语句再列表页代码里做区分的，如果当前需要展示版本A，url参数当中传入version
当用户到了列表页面加入购物车下单的时候
我们用代码再提交给购物车的订单上做了一个标记(from-version)
转化率的变化就是列表页性能优化醒目的优化数据
### 转化率急剧下降的情况
兼容性问题导致的，在iphone11和小米10的情况下，会出现列表菜单无法滚动的情况
性能优化项目一定要做好兼容性测试，特别是针对top10机型的手机和弱网的环境
在做性能监控预警的时候遇到某一个问题，因为性能问题不是短时间内可以解决的，导致预警邮件越来越多的，后来拖慢了预警速度，只能展示2个小时前的数据量如何解决？
