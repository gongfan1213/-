# TCP基本认识
## tcp头格式有哪些？
序列号：
在建立链接的时候由计算机生成的随机数作为初始化值，通过SYN包传递给接收端的住，每次发送一次数据，就累加一次改数据的字节数的大小，用来解决网络包的乱序的问题
确认应答号：
指的是下一次期望收到的数据序列号
发送端收到这个确认应答以后可以认为这个序号以前的数据都已经被正常接收了，用来解决丢包的问题
控制位：
ack:1确认应答位，tcp规定除了最初建立链接的时候SYN的包之外该位必须设置为1
RST：1表示tcp链接当中出现异常必须强制断开链接,
SYN:该为为1的时候，表示希望建立链接，并且在其序列号的字段进行序列号初始值的设定
FIN：1，表示今后不会再有数据发送的，希望断开链接，当通信结束希望断开链接的时候通信双方的主机之间就可以相互交换FIN为1的tcp段
# 为什么需要tcptcp工作在哪一层？
如果需要保障网络数据包的可靠性，就需要由上层的传输的tcp协议来负责
ip层是不可靠的，不保证网络包的可靠交付包保证网络包的按需交付的
tcp是一个工作在传输层的可靠的数据传输服务，确保接收端接收的网络报是无损坏的，无间隔的，非冗余的，按需的
无损害的，无间隔的，非冗余的，按序的
# 什么是tcp
面向连接，可靠的，字节流的
面向连接的可靠的，基于字节流的传输层通信协议
面向连接：一定是一对一的才能连接，不能像udp协议一对多的
可靠的，无论网络的链路出现了怎么样的链路变化，tcp都可以保证一个报文一定能够到达接收端的
字节流的：用户消息通过tcp协议传输，消息可能会被操作系统分组成多个tcp报文的，如果接收方的程序如果不知道消息的边界，是无法读出一个有效的用户的消息的。并且tcp报文是有序的，当前一个tcp报文没有收到的是偶，即使他先收到了后面的tcp报文，那么也不能扔给应用层去处理的，同时对于重复的tcp报文会自动丢弃的
# tcp链接？
用于保证可靠性的和流量控制的维护某些状态信息，这些信息的组合，包括socket,序列号和窗口大小称为链接
建立一个tcp链接是需要客户端和服务器达成上面三个信息的共识的
socket由ip地址和端口号组成的
序列号：用来解决乱序问题
窗口大小流量控制的
# 确定唯一的tcp链接
TCP 四元组可以唯一的确定一个连接，四元组包括如下：

源地址
源端口
目的地址
目的端口
源地址和目的地址的字段（32 位）是在 IP 头部中，作用是通过 IP 协议发送报文给对方主机。
源端口和目的端口的字段（16 位）是在 TCP 头部中，作用是告诉 TCP 协议应该把报文
发给哪个进程。
有一个 IP 的服务端监听了一个端口，它的 TCP 的最大连接数是多少？
最大的tcp链接数量=客户端ip数量*客户端的端口数量
服务端通常固定在某个本地端口上监听，等待客户端的连接请求。
因此，客户端 IP 和端口是可变的，其理论值计算公式如下:
对 IPv4，客户端的 IP 数最多为 2的 32
次方，客户端的端口数最多为2的 16次方，也就是服务端单机最大 TCP 连接数，约为 2的 48次方。
当然，服务端最大并发 TCP 连接数远不能达到理论上限，会受以下因素影响：
文件描述符限制，每个 TCP 连接都是一个文件，如果文件描述符被占满了，会发生 Too many open files。Linux 对可打开的文件描述符的数量分别作了三
个方面的限制：
系统级：当前系统可打开的最大数量，通过 cat /proc/sys/fs/file-max查看；
用户级：指定用户可打开的最大数量，通过 cat /etc/security/limits.conf查看；
进程级：单个进程可打开的最大数量，通过 cat /proc/sys/fs/nr_open查看；
内存限制，每个 TCP 连接都要占用一定内存，操作系统的内存是有限的，如果内存资源被占满后，会发生 OOM。
# udp和tcp区别？应用场景？
UDP提供的是无连接服务，不提供复杂的控制机制的，头部只有64位
目标和源端口：主要是告诉 UDP 协议应该把报文发给哪个进程。
包长度：该字段保存了 UDP 首部的长度跟数据的长度之和。
校验和：校验和是为了提供可靠的 UDP 首部和数据而设计，防止收到在网络传输中受损的 UDP 包。
源端口号，目标端口号，包长度，校验和，数据
## 1。链接
tcp面向连接的传输层协议，传输数据前先要建立链接，udp是不需要链接的，就是立即传输数据
## 2。服务对象
tcp是一对一的两点服务，就是一条链接只有两个端点。udp支持一对一，一对多的，多嘴多的交互通信
## 可靠性：
tcp是可靠交付数据的，数据可以无差错不丢失，不重复，按需到达
udp是尽最大努力交付的，不保证数据的可靠交付，但是我们可以给予udp传输是先一个可靠的传输协议
目标和源端口：主要是告诉 UDP 协议应该把报文发给哪个进程。
包长度：该字段保存了 UDP 首部的长度跟数据的长度之和。
校验和：校验和是为了提供可靠的 UDP 首部和数据而设计，防止收到在网络传输中受损的 UDP 包。
## 拥塞控制和流量控制
tcp有拥塞控制和流量控制，保证数据传输的安全性
udp没有，即使网络非常拥堵了，也不会影响udp发送速率的
## 首部开销的
tcp首部长度较长的，会有一定的开销的，首部在没有使用选项字段的时候是20个字节，如果使用了选项字段会边长的
udp首部只有8个字节，并且是固定不变的，开销较小的
## 传输方式
tcp流式传输，没有边界的，保证顺序和可靠的，udp是一个一个包发送的是有边界，丢包或者乱序的
## 分片不同
tcp的数据大小如果大于MSS的大小，则会在传输层进行分片，目标主机收到以后也会在传输层组装tcp数据包，如果中途丢失一个分片，只需要传输丢失的这个分片，udp数据大小如果大于mtu大小，就会在ip层进行分片，标主机收到后，在 IP 层组装完数据，接着再传给传输层。
