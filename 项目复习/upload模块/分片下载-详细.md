> ðŸ’­ å¥½çš„ï¼Œæˆ‘çŽ°åœ¨éœ€è¦ä»”ç»†åˆ†æžç”¨æˆ·æä¾›çš„åˆ†ç‰‡ä¸‹è½½ä»£ç â€”â€”`parallelDownload`å‡½æ•°ã€‚ç”¨æˆ·çš„è¯·æ±‚æ˜¯è¯¦ç»†è®²è§£è¿™ä¸ªåˆ†ç‰‡ä¸‹è½½çš„é€»è¾‘ï¼Œå› æ­¤æˆ‘éœ€è¦é€æ­¥æ‹†è§£æ•´ä¸ªæµç¨‹ï¼Œå¹¶æŒ‡å‡ºå¯èƒ½çš„é—®é¢˜å’Œä¼˜åŒ–ç‚¹ã€‚
>
> é¦–å…ˆï¼Œç”¨æˆ·æä¾›çš„è¿™ä¸ªå‡½æ•°ä¸»è¦æ˜¯ä¸ºäº†å®žçŽ°å¹¶è¡Œåˆ†ç‰‡ä¸‹è½½ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œç„¶åŽå°†ä¸‹è½½çš„åˆ†ç‰‡åˆå¹¶æˆä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶ã€‚è®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„ç»“æž„ï¼š
>
> 1. **å‚æ•°è§£æž**ï¼š
>
>    - `url`ï¼šè¦ä¸‹è½½çš„æ–‡ä»¶çš„URLã€‚
>
>    - `options`ï¼šå¯é€‰å‚æ•°ï¼ŒåŒ…å«åˆ†ç‰‡æ•°é‡`splitNumber`å’Œè¿›åº¦å›žè°ƒ`onProcess`ã€‚
>
> 2. **åˆå§‹è®¾ç½®**ï¼š
>
>    - `SPLIT_NUM`é»˜è®¤ä¸º4ï¼Œå³åˆ†4ä¸ªéƒ¨åˆ†ä¸‹è½½ã€‚
>
>    - `downloadedBytes`æ•°ç»„ç”¨äºŽè·Ÿè¸ªæ¯ä¸ªåˆ†ç‰‡çš„å·²ä¸‹è½½å­—èŠ‚æ•°ã€‚
>
>    
>
> 3. **èŽ·å–æ–‡ä»¶æ€»å¤§å°**ï¼š
>
>    - å‘é€ä¸€ä¸ªå¸¦æœ‰`Range: bytes=0-0`çš„è¯·æ±‚ï¼Œé€šè¿‡`Content-Range`å¤´èŽ·å–æ–‡ä»¶çš„æ€»é•¿åº¦`contentLength`ã€‚
>
>    - è¿™é‡Œè¦æ³¨æ„ï¼Œå¦‚æžœæœåŠ¡å™¨ä¸æ”¯æŒRangeè¯·æ±‚ï¼Œé‚£ä¹ˆæ— æ³•èŽ·å–æ€»å¤§å°ï¼ŒåŽç»­çš„åˆ†ç‰‡ä¸‹è½½ä¹Ÿæ— æ³•è¿›è¡Œã€‚
>
> 4. **åˆ†ç‰‡ä¸‹è½½**ï¼š
>
>    - æ ¹æ®åˆ†ç‰‡æ•°å’Œæ€»å¤§å°è®¡ç®—æ¯ä¸ªåˆ†ç‰‡çš„èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚
>
>    - ä½¿ç”¨`Promise.all`å¹¶è¡Œå‘èµ·å¤šä¸ªè¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚ä¸‹è½½ä¸åŒçš„å­—èŠ‚èŒƒå›´ã€‚
>
>    
>
> 5. **æ•°æ®è¯»å–å’Œè¿›åº¦æ›´æ–°**ï¼š
>
>    - æ¯ä¸ªåˆ†ç‰‡ä½¿ç”¨`ReadableStream`è¯»å–æ•°æ®ï¼Œå¹¶å®žæ—¶æ›´æ–°`downloadedBytes`æ•°ç»„ã€‚
>
>    - æ¯æ¬¡è¯»å–æ•°æ®å—æ—¶ï¼Œç´¯åŠ å·²ä¸‹è½½çš„å­—èŠ‚æ•°ï¼Œå¹¶é€šè¿‡`onProcess`å›žè°ƒæŠ¥å‘Šæ€»è¿›åº¦ã€‚
>
> 6. **åˆå¹¶åˆ†ç‰‡**ï¼š
>
>    - æ‰€æœ‰åˆ†ç‰‡ä¸‹è½½å®ŒæˆåŽï¼Œè°ƒç”¨`mergeArrayBuffers`å°†å¤šä¸ª`ArrayBuffer`åˆå¹¶ä¸ºä¸€ä¸ªã€‚
>
>    - åˆå¹¶åŽçš„æ–‡ä»¶ä¿å­˜ä¸º`File`å¯¹è±¡ï¼Œå¸¦æœ‰ä»ŽURLè§£æžå‡ºçš„æ–‡ä»¶åã€‚
>
> åœ¨ç†è§£ä»£ç ç»“æž„ä¹‹åŽï¼Œæˆ‘éœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªå…³é”®ç‚¹ï¼š
>
> - **åˆ†ç‰‡ç­–ç•¥**ï¼šå½“å‰çš„åˆ†ç‰‡æ˜¯å‡åˆ†çš„ï¼Œæ¯”å¦‚æ€»é•¿100å­—èŠ‚ï¼Œåˆ†4ç‰‡åŽæ¯ç‰‡25å­—èŠ‚ã€‚è¿™æ˜¯å¦åˆç†ï¼Ÿæ¯”å¦‚å½“æ€»é•¿åº¦ä¸èƒ½è¢«åˆ†ç‰‡æ•°æ•´é™¤æ—¶å¦‚ä½•å¤„ç†ã€‚
>
>   
>
> - **é”™è¯¯å¤„ç†**ï¼šç›®å‰ä»£ç ä¸­å¯¹äºŽ`fetch`æˆ–åˆå¹¶è¿‡ç¨‹ä¸­å¯èƒ½å‡ºçŽ°çš„é”™è¯¯å¤„ç†æ˜¯å¦å……åˆ†ï¼Ÿä¾‹å¦‚ï¼Œç½‘ç»œé”™è¯¯ã€åˆå¹¶æ—¶çš„å†…å­˜ä¸è¶³ç­‰ã€‚
>
> - **è¿›åº¦è®¡ç®—çš„å‡†ç¡®æ€§**ï¼šä½¿ç”¨`downloadedBytes`æ•°ç»„ç´¯åŠ å„ä¸ªåˆ†ç‰‡çš„å¤§å°ï¼Œæ˜¯å¦ä¼šå‡ºçŽ°å¹¶å‘æ›´æ–°çš„é—®é¢˜ï¼Ÿæ¯”å¦‚å¤šä¸ªåˆ†ç‰‡åŒæ—¶æ›´æ–°æ•°ç»„ï¼Œå¯èƒ½å¯¼è‡´è¿›åº¦è®¡ç®—ä¸å‡†ç¡®ã€‚
>
> - **æ€§èƒ½é—®é¢˜**ï¼šä¸€æ¬¡æ€§å¹¶è¡Œå¤šä¸ª`fetch`è¯·æ±‚ï¼Œå¯¹äºŽæµè§ˆå™¨æˆ–æœåŠ¡å™¨æ˜¯å¦ä¼šæœ‰å¹¶å‘é™åˆ¶ï¼Ÿå°¤å…¶æ˜¯å½“åˆ†ç‰‡æ•°ï¼ˆå¦‚è®¾ç½®ä¸ºè¾ƒé«˜å€¼ï¼‰è¾ƒå¤šæ—¶ï¼Œå¯èƒ½è§¦å‘æµè§ˆå™¨çš„åŒæºå¹¶å‘é™åˆ¶ã€‚
>
> - **å†…å­˜ä½¿ç”¨**ï¼š`mergeArrayBuffers`ä¼šåˆ†é…ä¸€ä¸ªå¤§å†…å­˜å—ï¼Œå¦‚æžœæ–‡ä»¶å¾ˆå¤§ï¼ˆæ¯”å¦‚1GBï¼‰ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜åŽ‹åŠ›ï¼Œç”šè‡³å´©æºƒã€‚æ˜¯å¦æœ‰æµå¼åˆå¹¶çš„å¯èƒ½ï¼Ÿ
>
> æŽ¥ä¸‹æ¥ï¼Œé’ˆå¯¹æ¯ä¸€ä¸ªé—®é¢˜ç‚¹è¿›è¡Œè¯¦ç»†åˆ†æžï¼š
>
> **åˆ†ç‰‡ç­–ç•¥**ï¼š
>
> å½“å‰çš„`chunkSize`æ˜¯`Math.ceil(contentLength / 4)`ï¼Œè¿™æ ·æœ€åŽä¸€ä¸ªåˆ†ç‰‡çš„ç»“æŸä½ç½®ç”¨`Math.min(cursor + chunkSize - 1, contentLength)`ï¼Œè¿™é‡Œæ˜¯å¦æœ‰é”™è¯¯ï¼Ÿ
>
> æ¯”å¦‚å½“æ€»é•¿åº¦æ˜¯10ï¼Œåˆ†4ç‰‡çš„è¯ï¼Œæ¯ä¸ªåˆ†ç‰‡å¤§å°æ˜¯3ï¼ˆ10/4=2.5ï¼ŒceilåŽ3ï¼‰ã€‚å› æ­¤åˆ†ç‰‡çš„èµ·å§‹å’Œç»“æŸä½ç½®åº”è¯¥ä¸ºï¼š
>
> 0-2ï¼Œ3-5ï¼Œ6-8ï¼Œ9-9ã€‚å¯¹å—ï¼Ÿ
>
> æ˜¯çš„ï¼Œè¿™æ ·å¯ä»¥é¿å…è¶…å‡ºæ–‡ä»¶æ€»é•¿åº¦ã€‚ä½†éœ€è¦æ³¨æ„ï¼Œæ˜¯å¦è¦†ç›–æ•´ä¸ªæ–‡ä»¶çš„æ‰€æœ‰å­—èŠ‚ã€‚
>
> **é”™è¯¯å¤„ç†**ï¼š
>
> åœ¨`fetch`è¯·æ±‚ä¸­ï¼Œå¦‚æžœæŸä¸ªåˆ†ç‰‡ä¸‹è½½å¤±è´¥ï¼ˆæ¯”å¦‚ç½‘ç»œé—®é¢˜æˆ–æœåŠ¡å™¨ä¸æ”¯æŒRangeè¯·æ±‚ï¼‰ï¼Œå½“å‰ä»£ç ä¸­åœ¨`res.headers.get('Content-Range')`å¦‚æžœå¤±è´¥æ˜¯å¦ä¼šæŠ›å‡ºï¼Ÿ
>
> æ¯”å¦‚ï¼Œéƒ¨åˆ†æœåŠ¡å™¨å¯èƒ½ä¸æ”¯æŒRangeè¯·æ±‚ï¼Œå¯¼è‡´è¿”å›ž200è€Œä¸æ˜¯206 Partial Contentã€‚æ­¤æ—¶æ— æ³•æ­£ç¡®èŽ·å–åˆ°Content-Rangeï¼Œå¯¼è‡´`contentLength`ä»ç„¶ä¸º0ï¼ŒåŽé¢ä¼šæŠ›å‡º'Partial download failed'ã€‚è¿™å·²ç»å¤„ç†äº†åˆå§‹è¯·æ±‚ï¼Œä½†å…·ä½“çš„åˆ†ç‰‡è¯·æ±‚ä¸­çš„é”™è¯¯æ²¡æœ‰å¤„ç†ï¼Œæ¯”å¦‚æŸä¸ªåˆ†ç‰‡ä¸‹è½½å¤±è´¥ä¼šå˜æˆ`Promise`è¢«rejectï¼Œä½†ç”±äºŽç”¨äº†`Promise.all`ï¼Œä»»æ„ä¸€ä¸ªå¤±è´¥éƒ½ä¼šå¯¼è‡´æ•´ä¸ªä¸‹è½½å¤±è´¥ã€‚ä½†ä»£ç ä¸­çš„`.catch((err) => { ... })`åªåœ¨åˆå§‹è¯·æ±‚æ—¶æœ‰ï¼Œè€Œåˆ†ç‰‡è¯·æ±‚ä¸­æ²¡æœ‰é”™è¯¯å¤„ç†ã€‚è¿™å¯èƒ½éœ€è¦åœ¨æ¯ä¸ªåˆ†ç‰‡çš„fetchæ·»åŠ catchå¤„ç†ï¼Œå¦åˆ™æœªæ•èŽ·çš„rejectä¼šå¯¼è‡´æ•´ä¸ªå‡½æ•°å¤±è´¥ã€‚
>
> **è¿›åº¦è®¡ç®—**ï¼š
>
> ä½¿ç”¨ä¸€ä¸ªæ•°ç»„`downloadedBytes`æ¥è®°å½•æ¯ä¸ªåˆ†ç‰‡çš„å·²ä¸‹è½½å­—èŠ‚ã€‚æ¯æ¬¡æ”¶åˆ°æ•°æ®å—æ—¶ï¼Œæ›´æ–°å¯¹åº”åˆ†ç‰‡çš„è®¡æ•°å™¨ï¼Œå¹¶é‡æ–°è®¡ç®—æ€»å’Œã€‚è¿™é‡Œå¯èƒ½å­˜åœ¨å¹¶å‘æ›´æ–°çš„é—®é¢˜å—ï¼Ÿå› ä¸ºæ¯ä¸ªåˆ†ç‰‡çš„`reader.read()`æ˜¯å¼‚æ­¥çš„ï¼Œè€ŒJavaScriptæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥å¯¹æ•°ç»„çš„ä¿®æ”¹æ˜¯é¡ºåºçš„ï¼Œä¸ä¼šæœ‰ç«žæ€æ¡ä»¶çš„é—®é¢˜ã€‚ä½†æ ¹æ®ä»£ç é€»è¾‘ï¼Œæ¯æ¬¡æ•°æ®åˆ°è¾¾æ—¶ï¼Œ`downloadedBytes[index] += value?.byteLength || 0`ï¼Œç„¶åŽè®¡ç®—æ€»å’Œã€‚è¿™ä¸€æ­¥æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºæ˜¯é€ä¸ªå¼‚æ­¥å¤„ç†ï¼Œä¸ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªindexçš„æƒ…å†µã€‚ä½†å¯¹äºŽå¤šä¸ªåˆ†ç‰‡çš„å¹¶å‘å¤„ç†ï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œè¿™äº›ç´¯åŠ æ“ä½œï¼Œä½†å› ä¸ºæ˜¯å•çº¿ç¨‹ï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿæ•°æ®ç«žäº‰ã€‚
>
> **æ€§èƒ½é—®é¢˜**ï¼š
>
> å‡è®¾SPLIT_NUMè®¾ç½®ä¸º4ï¼Œæµè§ˆå™¨çš„å¹¶å‘è¯·æ±‚æ•°ä¸€èˆ¬æ˜¯æœ‰é™åˆ¶çš„ï¼ˆä¾‹å¦‚Chromeå¯¹åŒä¸€åŸŸåçš„å¹¶å‘æ•°æ˜¯6ï¼‰ã€‚è¿™é‡Œåˆ†ç‰‡4ä¸ªè¯·æ±‚æ˜¯åœ¨åŒä¸€åŸŸåä¸‹ï¼Œæ‰€ä»¥æ²¡æœ‰é—®é¢˜ã€‚ä½†å¦‚æžœç”¨æˆ·è®¾ç½®splitNumberä¸ºæ›´é«˜çš„å€¼ï¼Œæ¯”å¦‚10ï¼Œå¯èƒ½ä¼šå¯¼è‡´éƒ¨åˆ†è¯·æ±‚è¢«æŽ’é˜Ÿï¼Œå½±å“ä¸‹è½½æ•ˆçŽ‡ã€‚
>
> æ­¤å¤–ï¼Œå¯¹äºŽå¤§æ–‡ä»¶æ¥è¯´ï¼Œå¹¶è¡Œå¤šè¯·æ±‚å¯èƒ½ä¼šæ›´å¿«ï¼Œä½†è¿™ä¹Ÿå–å†³äºŽæœåŠ¡å™¨çš„å¸¦å®½å’Œæ˜¯å¦èƒ½å¤„ç†å¤šä¸ªå¹¶å‘è¯·æ±‚ã€‚å¯èƒ½å­˜åœ¨æœåŠ¡å™¨ç«¯çš„é™é€Ÿæˆ–è´Ÿæ‹…åŠ é‡çš„é—®é¢˜ã€‚
>
> **å†…å­˜é—®é¢˜**ï¼š
>
> å°†æ‰€æœ‰åˆ†ç‰‡çš„ArrayBufferåˆå¹¶ä¸ºä¸€ä¸ªå¤§çš„ArrayBufferï¼Œå¯¹äºŽéžå¸¸å¤§çš„æ–‡ä»¶ï¼ˆæ¯”å¦‚å‡ ä¸ªGBï¼‰ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜ä¸è¶³ã€‚å°¤å…¶æ˜¯åœ¨æµè§ˆå™¨ä¸­ï¼ŒV8å¼•æ“Žå¯¹å†…å­˜çš„é™åˆ¶æ¯”è¾ƒä¸¥æ ¼ï¼Œç”¨æˆ·å¯èƒ½ä¼šé‡åˆ°å†…å­˜æº¢å‡ºçš„é”™è¯¯ã€‚
>
> æ›¿ä»£æ–¹æ¡ˆå¯ä»¥æ˜¯æµå¼å¤„ç†ï¼Œè¾¹ä¸‹è½½è¾¹å†™å…¥åˆ°ç£ç›˜ï¼Œæˆ–è€…åœ¨ä¸‹è½½å®ŒæˆåŽä½¿ç”¨Blobç›´æŽ¥åˆå¹¶ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰åˆ†ç‰‡æ•°æ®ä¿ç•™åœ¨å†…å­˜ä¸­ã€‚
>
> 
çŽ°åœ¨å›žåˆ°`parallelDownload`å‡½æ•°çš„å…·ä½“å®žçŽ°ï¼Œé€ä¸€åˆ†æžï¼š
>
> 1. **åˆå§‹èŽ·å–contentLength**ï¼š
>
>
> ```typescript
>
> const contentLength = await fetch(url, {
>
>   method: 'GET',
>
>   credentials: 'omit',
>
>   headers: { Range: 'bytes=0-0' },
>
> }).then(...)
>
> ```
>
> è¿™ä¸€æ­¥å‘é€ä¸€ä¸ªåªéœ€è¦å¤´éƒ¨çš„è¯·æ±‚ï¼ˆå› ä¸ºRangeæ˜¯0-0ï¼‰ï¼Œæ ¹æ®HTTPè§„èŒƒï¼ŒæœåŠ¡å™¨åº”è¯¥è¿”å›ž`Content-Range: bytes 0-0/12345`è¿™æ ·çš„å¤´ï¼Œå…¶ä¸­12345æ˜¯æ€»é•¿åº¦ã€‚è¿™æ ·åšæ˜¯æ­£ç¡®çš„ã€‚
>
> 2. **æ£€æŸ¥`contentLength`æ˜¯å¦æœ‰æ•ˆ**ï¼š
>
> ```typescript
>
> if (contentLength > 0) { ... } else { throw ... }
>
> ```
>
> å¦‚æžœæœªæˆåŠŸèŽ·å–ï¼ŒæŠ›å‡ºé”™è¯¯ï¼Œæµç¨‹æ˜¯æ­£ç¡®çš„ã€‚
>
> 3. **åˆ†ç‰‡è¯·æ±‚çš„Headersè®¾ç½®**ï¼š
>
> æ¯ä¸ªåˆ†ç‰‡çš„Rangeå¤´è®¾ç½®ä¸º`bytes=${cursor}-${Math.min(cursor + chunkSize -1, contentLength)}`ï¼Œè¿™é‡Œçš„`chunkSize`æ˜¯`Math.ceil(contentLength /4)`ã€‚ä¸¾ä¸ªä¾‹å­ï¼š
>
> contentLengthä¸º10ï¼ŒSPLIT_NUMä¸º4æ—¶ï¼ŒchunkSizeæ˜¯3ã€‚
>
> åˆ†ç‰‡çš„Rangeå¤´åº”è¯¥æ˜¯ï¼š
>
> - åˆ†ç‰‡0ï¼š0-2ï¼ˆ3å­—èŠ‚ï¼‰
>
> - åˆ†ç‰‡1ï¼š3-5
>
> - åˆ†ç‰‡2ï¼š6-8
>
> - åˆ†ç‰‡3ï¼š9-9ï¼ˆå› ä¸ºæ˜¯10-1=9ï¼‰
>
> è¿™æ ·çš„åˆ†ç‰‡ç­–ç•¥æ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºæ¯ä¸ªåˆ†ç‰‡çš„èµ·å§‹ä½ç½®æ˜¯å‰ä¸€ä¸ªåˆ†ç‰‡çš„ç»“æŸä½ç½®+1ã€‚ä½†éœ€è¦ç¡®è®¤æ˜¯å¦è¦†ç›–æ•´ä¸ªæ–‡ä»¶ã€‚æ¯”å¦‚æ€»é•¿åº¦æ˜¯10ï¼Œæœ€åŽä¸€ä¸ªåˆ†ç‰‡çš„ç»“æŸä½ç½®æ˜¯9ï¼Œç¡®å®žæ­£ç¡®ã€‚
>
> ä½†æ˜¯åœ¨å¾ªçŽ¯ä¸­cursorçš„è®¡ç®—ä¸º`cursor = chunkSize * index`ï¼Œæ¯”å¦‚å½“indexæ˜¯0æ—¶ï¼Œcursoræ˜¯0ï¼›index=1æ—¶ï¼Œcursor=chunkSize=3ï¼ŒRangeæ˜¯3-5ï¼Œè¿™æ²¡é—®é¢˜ã€‚æ˜¯çš„ï¼Œæ¯ä¸ªåˆ†ç‰‡ä½¿ç”¨chunkSizeçš„é—´éš”ï¼Œèµ·å§‹æ˜¯chunkSize*indexï¼Œç»“æŸäºŽ chunkSize*(index+1)-1 æˆ–æ–‡ä»¶æœ«å°¾ã€‚
>
> ä¾‹å¦‚ï¼Œå¯¹äºŽæ€»é•¿åº¦12ï¼Œåˆ†ç‰‡æ•°ä¸º4ï¼ŒchunkSizeä¸º3ï¼š
>
> åˆ†ç‰‡0ï¼š0-3-1=2 â†’0-2
>
> åˆ†ç‰‡1ï¼š3-5
>
> åˆ†ç‰‡2ï¼š6-8
>
> åˆ†ç‰‡3ï¼š9-11 â†’æ­£ç¡®è¦†ç›–æ‰€æœ‰å­—èŠ‚ã€‚
>
> è¿™æ ·å¤„ç†æ˜¯æ­£ç¡®çš„ã€‚
>
> 4. **æ¯ä¸ªåˆ†ç‰‡çš„æ•°æ®è¯»å–**ï¼š
>
> ä½¿ç”¨`response.body.getReader()`èŽ·å–å¯è¯»æµï¼Œç„¶åŽä¸æ–­è¯»å–æ•°æ®å—ï¼Œç´¯åŠ å·²ä¸‹è½½çš„å­—èŠ‚æ•°ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œ`value`æ˜¯`Uint8Array`ç±»åž‹çš„ï¼Œlengthæ˜¯byteLengthï¼Œå› æ­¤`value?.byteLength`æ˜¯æ­£ç¡®çš„ã€‚
>
> ç„¶åŽå°†æ¯ä¸ªåˆ†ç‰‡çš„æ•°æ®å­˜å…¥ReadableStreamï¼Œæœ€åŽé€šè¿‡`response.arrayBuffer()`è½¬æ¢ä¸ºArrayBufferã€‚è¿™ç§æ–¹å¼å¯èƒ½å¯¼è‡´å†…å­˜å ç”¨é—®é¢˜ï¼Œå› ä¸ºå®ƒå°†æ‰€æœ‰æ•°æ®å—æ”¶é›†åˆ°å†…å­˜ä¸­ï¼Œç„¶åŽå†åˆå¹¶ï¼Œå¯¹äºŽå¤§æ–‡ä»¶ä¸åˆ©ã€‚
>
> æ›´å¥½çš„åšæ³•å¯èƒ½æ˜¯åœ¨æµå¼å¤„ç†ä¸­ç›´æŽ¥å°†æ•°æ®å—å†™å…¥ç›®æ ‡ä½ç½®ï¼Œä½†æµè§ˆå™¨çŽ¯å¢ƒä¸‹å¤„ç†æ¯”è¾ƒå›°éš¾ï¼Œå› ä¸ºæ— æ³•ç›´æŽ¥æ“ä½œæ–‡ä»¶ç³»ç»Ÿã€‚ä½†å¦‚æžœæ˜¯ä¿å­˜æˆBlobï¼Œåˆ™å¯ä»¥ä½¿ç”¨`Blob`æž„é€ å‡½æ•°ï¼Œå®ƒæŽ¥å—æ•°ç»„çš„BlobPartï¼Œå¯èƒ½æ›´é«˜æ•ˆï¼Œè€Œä¸éœ€è¦åˆå¹¶ArrayBufferã€‚
>
> æ¯”å¦‚ï¼Œå°†æ¯ä¸ªåˆ†ç‰‡çš„ArrayBufferæ”¾å…¥æ•°ç»„ï¼Œç„¶åŽç›´æŽ¥ç”ŸæˆBlobï¼š
>
> ```javascript
>
> return new File(chunks, zipName, { type: '...' });
>
> ```
>
> ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªåˆ†ç‰‡çš„ArrayBufferå¿…é¡»æ˜¯æŒ‰ç…§é¡ºåºæŽ’åˆ—çš„ã€‚ä¸è¿‡ï¼Œæ ¹æ®Promise.allçš„æ‰§è¡Œé¡ºåºï¼Œchunksæ•°ç»„çš„å…ƒç´ æ˜¯æŒ‰åˆ†ç‰‡é¡ºåºæŽ’åˆ—çš„ï¼Œå› ä¸ºåœ¨ä»£ç ä¸­downloadedBytes.mapæ˜¯æŒ‰é¡ºåºç”Ÿæˆpromiseæ•°ç»„ï¼Œæ‰€ä»¥Promise.allçš„ç»“æžœæ•°ç»„é¡ºåºä¸Žåˆ†ç‰‡é¡ºåºä¸€è‡´ã€‚
>
> æ‰€ä»¥åœ¨åˆå¹¶çš„æ—¶å€™ï¼ŒmergeArrayBuffers(chunks)å¯ä»¥å¾—åˆ°æ­£ç¡®çš„é¡ºåºï¼Œç„¶åŽå°†æ‰€æœ‰chunksä¼ å…¥Fileæž„é€ ï¼Œé¡ºåºæ˜¯æ­£ç¡®çš„ã€‚ä½¿ç”¨æ—¶ï¼Œä¸éœ€è¦åˆå¹¶ï¼Œå¯ä»¥ç›´æŽ¥å°†æ•°ç»„ä¼ é€’ç»™Fileï¼Œè¿™æ ·æ›´é«˜æ•ˆã€‚
>
> ä¾‹å¦‚ï¼Œä¿®æ”¹æœ€åŽéƒ¨åˆ†ï¼š
>
> 
>
> // åŽŸæ¥çš„ï¼š
>
> .then(chunks => {
>
>   const mergedArrayBuffer = mergeArrayBuffers(chunks);
>
>   return new File([mergedArrayBuffer], zipName, ...);
})
>
> // å¯èƒ½çš„ä¼˜åŒ–ï¼š
>
> .then(chunks => {
>
>   return new File(chunks, zipName, { type: 'application/octet-stream' });
>
> })
>
> 
>
> è¿™æ ·å¯ä»¥é¿å…åˆå¹¶ArrayBufferçš„å†…å­˜å¼€é”€ï¼Œå› ä¸ºFileå¯ä»¥ç›´æŽ¥æŽ¥å—ArrayBufferçš„æ•°ç»„ï¼Œå¹¶ä¸”æŒ‰é¡ºåºç»„åˆæˆå®Œæ•´çš„æ–‡ä»¶ã€‚å› æ­¤ä¹‹å‰çš„mergeArrayBufferså¯èƒ½æ˜¯ä¸å¿…è¦çš„ï¼Œå¯ä»¥çœç•¥ï¼Œå‡å°‘å†…å­˜ä½¿ç”¨å’Œæ½œåœ¨çš„å¤§å†…å­˜åˆ†é…é—®é¢˜ã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªä¼˜åŒ–ç‚¹ã€‚
>
> é‚£è¿™ä¸ªé—®é¢˜æ˜¯ä¸æ˜¯éœ€è¦æŒ‡å‡ºæ¥ï¼Ÿç”¨æˆ·æä¾›çš„ä»£ç ä¸­çš„`mergeArrayBuffers`æ˜¯å¦çœŸçš„å¿…è¦ï¼Ÿ
>
> æ˜¯çš„ï¼Œè¿™é‡Œå¯èƒ½å­˜åœ¨ä¼˜åŒ–ç©ºé—´ã€‚å› ä¸ºåˆå¹¶ArrayBufferçš„æ–¹å¼éœ€è¦ä¸€æ¬¡æ€§ç”³è¯·å†…å­˜ï¼Œè€Œå¯¹äºŽå¤§æ–‡ä»¶ä¸å¯è¡Œã€‚è€Œç›´æŽ¥ä½¿ç”¨`new File(chunks, ...)`å¯ä»¥è®©æµè§ˆå™¨åœ¨éœ€è¦çš„æ—¶å€™æŒ‰éœ€è¯»å–ï¼Œä¸ä¼šå ç”¨è¿žç»­å†…å­˜ã€‚
>
> é‚£ä¹ˆï¼ŒåŽç»­çš„`mergeArrayBuffers`å¯èƒ½å¯ä»¥åˆ æŽ‰ï¼Œç›´æŽ¥ä¼ é€’chunksæ•°ç»„åˆ°Fileæž„é€ å‡½æ•°ä¸­ã€‚ä¹Ÿé¿å…äº†åˆå¹¶çš„å†…å­˜é—®é¢˜ã€‚è¿™æ ·ä¼šæ›´é«˜æ•ˆï¼Œå°¤å…¶æ˜¯å¤„ç†å¤§æ–‡ä»¶æ—¶ã€‚
>
> æŽ¥ä¸‹æ¥ï¼Œå…³äºŽè¿™ä¸ªå‡½æ•°çš„æ½œåœ¨é—®é¢˜å’Œæ”¹è¿›ç‚¹ï¼š
>
> **çŽ°æœ‰ç¼ºé™·ä¸Žä¼˜åŒ–å»ºè®®ï¼š**
>
> 1. **ä¸å¿…è¦çš„ArrayBufferåˆå¹¶**ï¼š
>
>    åˆå¹¶å…¨éƒ¨ArrayBufferä¸ºå•ä¸ªä¼šå¯¼è‡´å†…å­˜åŒå€å ç”¨ï¼ˆæ¯ä¸ªåˆ†ç‰‡ä¿å­˜ä¸€ä»½ï¼Œåˆå¹¶åˆä¿å­˜ä¸€ä»½ï¼‰ã€‚è€Œç›´æŽ¥ä½¿ç”¨åˆ†ç‰‡çš„ArrayBufferæ•°ç»„åˆ›å»ºFileä¼šæ›´é«˜æ•ˆã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªå…³é”®çš„ä¼˜åŒ–ç‚¹ã€‚
>
>    ä¾‹å¦‚ï¼Œæµè§ˆå™¨å®žçŽ°Fileæ—¶ï¼Œå¯ä»¥æ™ºèƒ½åœ°å¼•ç”¨è¿™äº›ArrayBufferè€Œä¸éœ€è¦è¿žç»­å†…å­˜ã€‚
>
> 2. **å†…å­˜å ç”¨é«˜å³°**ï¼š
>
>    åŒæ—¶å¹¶è¡Œä¸‹è½½å¤šä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡çš„ArrayBufferéƒ½ä¼šä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°æ‰€æœ‰åˆ†ç‰‡å®Œæˆã€‚å¦‚æžœåˆ†ç‰‡æ•°è¾ƒå¤šæˆ–æ–‡ä»¶å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜å³°å€¼è¿‡é«˜ã€‚å¯ä»¥æ”¹ä¸ºæµå¼å¤„ç†ï¼Œè¾¹ä¸‹è½½è¾¹å†™å…¥ï¼Œä½†æµè§ˆå™¨çŽ¯å¢ƒä¸‹éœ€è¦Service Workeræˆ–FileSystem APIæ”¯æŒï¼Œå¦åˆ™éš¾ä»¥å®žçŽ°ã€‚
>
> 3. **é”™è¯¯å¤„ç†ä¸è¶³**ï¼š
>
>    å½“å‰åˆ†ç‰‡è¯·æ±‚ä¸­çš„é”™è¯¯ä»…åœ¨Promise.allä¸­è¢«æ•èŽ·ï¼Œä½†æ¯ä¸ªåˆ†ç‰‡çš„é”™è¯¯å¤„ç†æœªå•ç‹¬å¤„ç†ï¼Œå¯èƒ½å¯¼è‡´æ•´ä¸ªä¸‹è½½å¤±è´¥ã€‚åº”è¯¥ä¸ºæ¯ä¸ªåˆ†ç‰‡çš„Promiseæ·»åŠ catchå¤„ç†ï¼Œé¿å…å› ä¸€ä¸ªåˆ†ç‰‡å¤±è´¥å¯¼è‡´æ•´ä¸ªä»»åŠ¡å¤±è´¥ï¼Œå¹¶å…è®¸é‡è¯•ã€‚
>
> 4. **è¿›åº¦è®¡ç®—çš„ç²¾ç¡®æ€§**ï¼š
>
>    å½“å‰çš„è¿›åº¦è®¡ç®—æ˜¯åŸºäºŽæ¯æ¬¡è¯»å–æ•°æ®å—æ—¶çš„ç´¯åŠ ï¼Œä½†ç”±äºŽç½‘ç»œæ³¢åŠ¨æˆ–ä¸åŒçš„åˆ†ç‰‡ä¸‹è½½é€Ÿåº¦ï¼Œå¯èƒ½å¯¼è‡´è¿›åº¦æ¡çš„ä¸å‡åŒ€å¢žé•¿ã€‚ä½†æ•´ä½“ä¸Šæ˜¯å‡†ç¡®çš„ã€‚
>
> 5. **åˆ†ç‰‡æ•°é™åˆ¶**ï¼š
>
>    splitNumberå¯èƒ½å—é™äºŽæµè§ˆå™¨çš„æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°ï¼Œé»˜è®¤ä¸º4æ˜¯å®‰å…¨çš„ï¼Œä½†è®¾ç½®æ›´é«˜å¯èƒ½å¯¼è‡´éƒ¨åˆ†è¯·æ±‚è¢«å»¶è¿Ÿå¤„ç†ã€‚
>
> 6. **HTTP Rangeè¯·æ±‚çš„å…¼å®¹æ€§**ï¼š
>
>    ä»£ç å‡è®¾æœåŠ¡å™¨æ”¯æŒRangeè¯·æ±‚ï¼Œå¦åˆ™åˆå§‹è¯·æ±‚ä¼šå¤±è´¥å¯¼è‡´æ•´ä¸ªå‡½æ•°æ— æ³•è¿›è¡Œã€‚å»ºè®®æå‰æ£€æµ‹æœåŠ¡å™¨æ˜¯å¦æ”¯æŒRangeè¯·æ±‚ï¼Œæˆ–è€…æä¾›é™çº§æ–¹æ¡ˆï¼ˆå¦‚å•çº¿ç¨‹ä¸‹è½½ï¼‰ã€‚
>
> **å…¶ä»–æ³¨æ„äº‹é¡¹ï¼š**
>
> - **è·¨åŸŸè¯·æ±‚**ï¼šå¦‚æžœurlçš„æœåŠ¡å™¨æœªæ­£ç¡®è®¾ç½®CORSï¼Œå¯èƒ½å¯¼è‡´è¯·æ±‚å¤±è´¥ï¼Œå°¤å…¶åœ¨å¸¦Rangeå¤´çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å¿…é¡»å…è®¸Rangeå¤´çš„è·¨åŸŸè¯·æ±‚ã€‚
>
> - **è®¤è¯é—®é¢˜**ï¼š`credentials: 'omit'`ä¼šå¯¼è‡´ä¸å¸¦cookieç­‰å‡­è¯ï¼Œå¦‚æžœä¸‹è½½éœ€è¦è®¤è¯çš„èµ„æºï¼Œå¯èƒ½éœ€è¦æ”¹ä¸º`include`ã€‚
>
> **æ€»ç»“æ”¹è¿›å»ºè®®ï¼š**
>
> 1. **ç§»é™¤ä¸å¿…è¦çš„ArrayBufferåˆå¹¶**ï¼š
>
>    ä½¿ç”¨`new File(chunks, name, ...)`æ›¿ä»£å…ˆåˆå¹¶å†åˆ›å»ºFileï¼Œé¿å…å†…å­˜æµªè´¹ã€‚
>
> 2. **å¢žå¼ºé”™è¯¯å¤„ç†**ï¼š
>
>    å¯¹æ¯ä¸ªåˆ†ç‰‡çš„fetchæ·»åŠ catchå¤„ç†ï¼Œå¯èƒ½å…è®¸é‡è¯•å¤±è´¥çš„chunkã€‚
>
> 3. **æµå¼å¤„ç†ä¼˜åŒ–**ï¼š
>
>    æŽ¢ç´¢ä½¿ç”¨Streams APIç›´æŽ¥æ‹¼æŽ¥æµï¼Œè¾¹ä¸‹è½½è¾¹åˆå¹¶ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚
>
> 4. **åŠ¨æ€åˆ†ç‰‡ç­–ç•¥**ï¼š
>
>    æ ¹æ®æ–‡ä»¶å¤§å°è‡ªåŠ¨è°ƒæ•´åˆ†ç‰‡æ•°é‡ï¼Œé¿å…è¿‡å¤§æˆ–è¿‡å°çš„åˆ†ç‰‡ã€‚
>
> 5. **æœåŠ¡å™¨å…¼å®¹æ€§æ£€æŸ¥**ï¼š
>
>    åœ¨åˆå§‹åŒ–é˜¶æ®µæ£€æµ‹æœåŠ¡å™¨æ˜¯å¦æ”¯æŒRangeè¯·æ±‚ï¼Œå¦‚æžœä¸æ”¯æŒåˆ™é™çº§ä¸ºå•çº¿ç¨‹ä¸‹è½½ã€‚
>
> ç»¼ä¸Šæ‰€è¿°ï¼Œç”¨æˆ·æä¾›çš„åˆ†ç‰‡ä¸‹è½½å‡½æ•°åœ¨åŸºæœ¬åŠŸèƒ½ä¸Šæ˜¯å¯è¡Œçš„ï¼Œä½†åœ¨å¤„ç†å¤§æ–‡ä»¶ã€å†…å­˜ç®¡ç†å’Œé”™è¯¯å¤„ç†ç­‰æ–¹é¢å­˜åœ¨ä¼˜åŒ–ç©ºé—´ã€‚åº”åœ¨å¿…è¦çš„æƒ…å†µä¸‹è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ä»¥å¢žå¼ºå…¶é²æ£’æ€§å’Œæ•ˆçŽ‡ã€‚
>
> 



åˆ†ç‰‡ä¸‹è½½çš„å®žçŽ°å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªå…³é”®æ–¹é¢è¯¦è§£ï¼š

---

### **1. æ ¸å¿ƒè®¾è®¡æ€è·¯**
åˆ†ç‰‡ä¸‹è½½é€šè¿‡å°†å¤§æ–‡ä»¶åˆ‡å‰²ä¸ºå¤šä¸ª**ç‹¬ç«‹çš„å­—èŠ‚èŒƒå›´è¯·æ±‚**ï¼Œåˆ©ç”¨æµè§ˆå™¨å¹¶è¡Œèƒ½åŠ›åŠ é€Ÿä¸‹è½½ï¼Œå…¸åž‹é€‚ç”¨äºŽå¤§æ–‡ä»¶ï¼ˆå¦‚è§†é¢‘ã€å®‰è£…åŒ…ç­‰ï¼‰çš„åœºæ™¯ä¼˜åŠ¿ï¼š
- **é€Ÿåº¦æå‡**ï¼šçªç ´å•çº¿ç¨‹ä¸‹è½½å¸¦å®½é™åˆ¶
- **æ–­ç‚¹ç»­ä¼ **ï¼šå¯è®°å½•æ¯ä¸ªåˆ†ç‰‡ä¸‹è½½çŠ¶æ€
- **é”™è¯¯éš”ç¦»**ï¼šå•åˆ†ç‰‡å¤±è´¥å¯ç‹¬ç«‹é‡è¯•

---

### **2. æµç¨‹æ‹†è§£**
#### **æ­¥éª¤1 - èŽ·å–æ€»å¤§å°**
```typescript
// å‘é€ä»…è¯·æ±‚å¤´éƒ¨çš„è¯•æŽ¢æ€§ Range è¯·æ±‚
const contentLength = await fetch(url, {
 headers: { Range: 'bytes=0-0' }
}).then(res => {
 // ä»Ž Content-Range å¤´è§£æžæ€»é•¿åº¦ 'bytes 0-0/123456'
 return res.headers.get('Content-Range')?.split('/')[1] 
})
```
![Rangeè¯·æ±‚ç¤ºæ„å›¾](https://lc-z0jeera74.cn-n1.lcfile.com/cf4b2f9d03a0bfe5.png)

---

#### **æ­¥éª¤2 - åˆ†ç‰‡åˆ‡å‰²**
```typescript
// åˆ†4ç‰‡ç¤ºä¾‹ï¼šæ€»å¤§å°100 â†’ æ¯ç‰‡25å­—èŠ‚ï¼ˆæœ€åŽä¸€ç‰‡å¯èƒ½æœ‰å‰©ä½™ï¼‰
const chunkSize = Math.ceil(contentLength / SPLIT_NUM)
const byteRanges = [
 { start: 0, end: 24 },         // bytes=0-24
 { start: 25, end: 49 },
 { start: 50, end: 74 },
 { start: 75, end: 99 }
]
```

---

#### **æ­¥éª¤3 - å¹¶è¡Œä¸‹è½½**
```typescript
const promises = byteRanges.map(range => 
 fetch(url, {
  headers: {
   Range: `bytes=${range.start}-${range.end}`
  }
 }).then(processStream)
)
```
![](https://lc-z0jeera74.cn-n1.lcfile.com/5cdab3c9d0ecda10.png)

---

#### **æ­¥éª¤4 - æµå¼å¤„ç†**
```typescript
// ç›‘å¬æ¯ä¸ªåˆ†ç‰‡çš„æ•°æ®å—åˆ°è¾¾
const reader = response.body.getReader()
while (true) {
 const { done, value } = await reader.read()
 if (done) break
 // å®žæ—¶æ›´æ–°è¯¥åˆ†ç‰‡çš„å·²æŽ¥æ”¶å­—èŠ‚æ•°
 downloadedBytes[index] += value.byteLength 
}
```

---

#### **æ­¥éª¤5 - åˆå¹¶å†…å®¹**
```typescript
// æŒ‰é¡ºåºæ‹¼æŽ¥åˆ†ç‰‡
const chunks = await Promise.all(promises)
const merged = mergeArrayBuffers(chunks) // ç”¨æˆ·æä¾›çš„æ ¸å¿ƒæ–¹æ³•

// ä¼˜åŒ–ç‚¹ï¼šå¯ç›´æŽ¥é€šè¿‡ Blob åˆå¹¶ï¼ˆæ— éœ€åˆå¹¶ArrayBufferï¼‰
return new File(chunks, filename) 
```

---

### **3. å…³é”®ä»£ç ç¼ºé™·ä¸Žä¿®å¤**

#### **3.1 å†…å­˜é—®é¢˜**
**åŽŸå§‹ä»£ç **ï¼š
```typescript
const mergedArrayBuffer = mergeArrayBuffers(chunks)
```
âš  åˆå¹¶åŽçš„`ArrayBuffer`ä¼šåŒæ—¶ä¿ç•™æ¯ä¸ªåˆ†ç‰‡çš„åŽŸå§‹æ•°æ®ï¼Œ100MBæ–‡ä»¶åˆ†4ç‰‡éœ€è¦ **200MBå†…å­˜**

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
```typescript
// ç›´æŽ¥ä¼ é€’æœªåˆå¹¶çš„åˆ†ç‰‡æ•°ç»„ç»™ File æž„é€ å‡½æ•°
return new File(chunks, zipName) 
```

---

#### **3.2 åˆ†ç‰‡è¾¹ç•Œé”™è¯¯**
å‡è®¾æ€»é•¿åº¦ 11ï¼Œåˆ†ç‰‡æ•° 3ï¼š
```typescript
// å½“å‰è®¡ç®—æ–¹å¼ï¼ˆé”™è¯¯ï¼‰
chunkSize = Math.ceil(11/3) = 4
åˆ†ç‰‡èŒƒå›´ï¼š[0-3], [4-7], [8-11]
// âš æœ€åŽä¸€ç‰‡ 8-11 è¶…å‡ºçœŸå®žè¾¹ç•Œ10

// ä¿®æ­£åŽçš„ç´¢å¼•è®¡ç®—
end = Math.min(start + chunkSize -1, contentLength-1)
```

---

#### **3.3 Rangeå¤´æ ¼å¼**
**é”™è¯¯ç¤ºä¾‹**ï¼š
```typescript
headers: { Range: `bytes=${start}-${end-1}` } // å®¹æ˜“é—æ¼æœ«ä½
```
æ­£ç¡®å†™æ³•ï¼šæœåŠ¡å™¨æŽ¥å—çš„Rangeæ ¼å¼ä¸º `bytes=start-end`ï¼ˆä¸¤è€…éƒ½å¿…éœ€æ˜¯æœ‰æ•ˆåç§»é‡ï¼‰

---

#### **3.4 è¿›åº¦è®¡ç®—è¯¯å·®**
å„åˆ†ç‰‡ä¸‹è½½é€Ÿåº¦ä¸åŒå¯èƒ½å¯¼è‡´å åŠ è¿›åº¦æ—¶å‡ºçŽ°çŸ­æš‚è¶…è¿‡100%çš„çŽ°è±¡ï¼š
```typescript
// å½“å‰ç­–ç•¥ï¼šç®€å•çš„åŠ æ³•å åŠ 
const totalDownloaded = downloadedBytes.reduce((a, b) => a + b)
const progress = totalDownloaded / contentLength

// è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨åŽŸå­çº§è®¡æ•°å™¨
const counter = new AtomicInteger(0)
counter.add(value.byteLength)
progress = counter.value / contentLength
```

---

### **4. è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ**

#### **4.1 åŠ¨æ€åˆ†ç‰‡ç­–ç•¥**
æ ¹æ®ç½‘ç»œçŽ¯å¢ƒè‡ªåŠ¨è°ƒæ•´åˆ†ç‰‡æ•°ï¼š
```typescript
// ä¿¡å·å¼ºåº¦é«˜ â†’ å¢žåŠ åˆ†ç‰‡æ•°
navigator.connection.addEventListener('change', () => {
 if (navigator.connection.effectiveType === '4g') {
  options.splitNumber = 8
 }
})
```

---

#### **4.2 æ–­ç‚¹ç»­ä¼ æœºåˆ¶**
```typescript
// æŒä¹…åŒ–å­˜å‚¨åˆ†ç‰‡ä¸‹è½½çŠ¶æ€
interface ChunkState {
 index: number	
 start: number
 end: number
 data?: ArrayBuffer
}

// æ¢å¤ä¸‹è½½æ—¶è·³è¿‡å·²å®Œæˆåˆ†ç‰‡
const unfinished = chunks.filter(c => !c.data)
```

---

#### **4.3 Workerå¤šçº¿ç¨‹
