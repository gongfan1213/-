> ğŸ’­ å¥½çš„ï¼Œè®©æˆ‘ä»”ç»†çœ‹çœ‹è¿™äº›ä»£ç ã€‚ç”¨æˆ·æä¾›çš„æ ‡å°ºæ’ä»¶ä¸»è¦æ¶‰åŠFabric.jsçš„è‡ªå®šä¹‰æ‰©å±•ï¼ŒåŒ…å«index.tsã€types.d.tså’Œutil.tsä¸‰ä¸ªéƒ¨åˆ†ã€‚éœ€è¦é€ä¸€åˆ†æå„ä¸ªæ¨¡å—çš„åŠŸèƒ½ï¼Œå¹¶ç†è§£å®ƒä»¬å¦‚ä½•åä½œå®ç°æ ‡å°ºå’Œè¾…åŠ©çº¿åŠŸèƒ½ã€‚
>
> é¦–å…ˆçœ‹index.tsï¼Œå®ƒå¯¼å…¥äº†Fabricçš„Canvaså’Œç›¸å…³çš„Rulerç±»ã€‚initRulerå‡½æ•°è´Ÿè´£åˆå§‹åŒ–æ ‡å°ºï¼Œåˆ›å»ºCanvasRulerå®ä¾‹ï¼Œå¹¶å¤„ç†è¾…åŠ©çº¿ï¼ˆGuideLineï¼‰çš„ç§»åŠ¨å’Œåˆ é™¤é€»è¾‘ã€‚ç”¨æˆ·æåˆ°å½“è¾…åŠ©çº¿è¢«ç§»åˆ°ç”»æ¿å¤–æ—¶åº”è¯¥åˆ é™¤ï¼Œè¿™éƒ¨åˆ†é€»è¾‘åœ¨guideline:movingå’Œguideline:mouseupäº‹ä»¶ä¸­å¤„ç†ã€‚éœ€è¦æ£€æŸ¥isRectOutå‡½æ•°çš„é€»è¾‘æ˜¯å¦æ­£ç¡®åˆ¤æ–­è¾…åŠ©çº¿æ˜¯å¦åœ¨workspaceå¤–éƒ¨ï¼Œç‰¹åˆ«æ˜¯getWorkspaceé€šè¿‡idæŸ¥æ‰¾workspaceå¯¹è±¡ï¼Œè¿™å¯èƒ½å­˜åœ¨æ½œåœ¨é—®é¢˜ï¼Œå¦‚æœidæœªæ­£ç¡®è®¾ç½®æˆ–æœªæ‰¾åˆ°å¯¹è±¡ï¼Œå¯èƒ½å¯¼è‡´é€»è¾‘å¤±æ•ˆã€‚
>
> æ¥ä¸‹æ¥æ˜¯types.d.tsï¼Œè¿™éƒ¨åˆ†æ‰©å±•äº†Fabricçš„ç±»å‹å®šä¹‰ï¼Œå°¤å…¶æ˜¯æ–°å¢äº†GuideLineç±»å’Œç›¸å…³äº‹ä»¶å¤„ç†ã€‚éœ€è¦ç¡®è®¤ç±»å‹å£°æ˜æ˜¯å¦å®Œæ•´ï¼Œä¾‹å¦‚IGuideLineOptionsä¸­å®šä¹‰çš„axisæ˜¯å¦ä¸ºå¿…è¦å±æ€§ï¼Œä»¥åŠæ‰€æœ‰äº‹ä»¶çš„å‚æ•°æ˜¯å¦æ­£ç¡®ã€‚å¦‚æœæœ‰ç±»å‹é”™è¯¯æˆ–é—æ¼ï¼Œå¯èƒ½åœ¨ç¼–è¯‘æˆ–è¿è¡Œæ—¶å‡ºç°é—®é¢˜ã€‚
>
> util.tsæä¾›äº†ä¸€äº›å®ç”¨å‡½æ•°ï¼Œæ¯”å¦‚è®¡ç®—æ ‡å°ºé—´éš”çš„getGapï¼Œåˆå¹¶çº¿æ®µçš„mergeLinesï¼Œä»¥åŠç»˜å›¾ç›¸å…³çš„å‡½æ•°ã€‚å…³é”®ç‚¹åœ¨äºgetGapå‡½æ•°ä½¿ç”¨çš„zoomå’Œgapså‚æ•°æ˜¯å¦åˆç†ã€‚å½“å‰çš„zoomså’Œgapsæ•°ç»„å¯èƒ½åœ¨æŸäº›ç¼©æ”¾çº§åˆ«ä¸‹å¯¼è‡´é—´éš”è¿‡å¤§æˆ–è¿‡å°ï¼Œéœ€è¦éªŒè¯åŒ¹é…é€»è¾‘æ˜¯å¦æ­£ç¡®ã€‚ä¾‹å¦‚ï¼Œå½“zoomä»‹äºä¸¤ä¸ªzoomså€¼æ—¶ï¼Œæ˜¯å¦å‡†ç¡®è·å–åˆ°å¯¹åº”çš„gapså€¼ã€‚
>
> å¦å¤–ï¼ŒdrawMaskå‡½æ•°ä½¿ç”¨æ¸å˜åˆ›å»ºé®ç½©æ•ˆæœï¼Œå¦‚æœç”»å¸ƒå°ºå¯¸è¾ƒå¤§æˆ–é¢‘ç¹è°ƒç”¨ï¼Œå¯èƒ½ä¼šå½±å“æ€§èƒ½ã€‚æ­¤å¤–ï¼ŒConsoleUtil.erroræ˜¯å¦æ­£ç¡®å¤„ç†é”™è¯¯ï¼Œé¿å…ç”Ÿäº§ç¯å¢ƒä¸­æš´éœ²è¿‡å¤šä¿¡æ¯ä¹Ÿæ˜¯éœ€è¦è€ƒè™‘çš„ã€‚
>
> ç”¨æˆ·å¯èƒ½é‡åˆ°çš„é—®é¢˜æ˜¯ï¼šè¾…åŠ©çº¿æ— æ³•æ­£ç¡®åˆ é™¤ï¼Œæ ‡å°ºåˆ»åº¦æ˜¾ç¤ºä¸å‡†ç¡®ï¼Œæˆ–è€…ç±»å‹æŠ¥é”™ã€‚éœ€è¦æ£€æŸ¥äº‹ä»¶ç›‘å¬æ˜¯å¦æ­£ç¡®è§¦å‘ï¼Œworkspaceå¯¹è±¡æ˜¯å¦å‡†ç¡®è·å–ï¼Œä»¥åŠç±»å‹å£°æ˜æ˜¯å¦ä¸å®é™…ä½¿ç”¨ä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œåœ¨index.tsä¸­ï¼Œå¦‚æœgetWorkspaceè¿”å›undefinedï¼Œåç»­çš„isRectOutå°†æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå¯¼è‡´è¾…åŠ©çº¿åˆ é™¤åŠŸèƒ½å¤±æ•ˆã€‚
>
> è¿˜éœ€è¦ç¡®è®¤Fabric.jsçš„ç‰ˆæœ¬å…¼å®¹æ€§ï¼Œå› ä¸ºç±»å‹æ‰©å±•å¯èƒ½ä¾èµ–äºç‰¹å®šç‰ˆæœ¬çš„Fabric APIã€‚å¦‚æœåœ¨å®é™…ä½¿ç”¨æ—¶å‘ç°ç±»å‹é”™è¯¯æˆ–æ–¹æ³•ä¸å­˜åœ¨ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ç±»å‹å£°æ˜æˆ–æ›´æ–°Fabricç‰ˆæœ¬ã€‚
>
> ç»¼ä¸Šæ‰€è¿°ï¼Œå…³é”®ç‚¹åŒ…æ‹¬æ­£ç¡®çš„äº‹ä»¶å¤„ç†ã€workspaceå¯¹è±¡çš„è·å–ã€é—´éš”è®¡ç®—çš„å‡†ç¡®æ€§ã€ç±»å‹å®šä¹‰çš„å®Œæ•´æ€§ï¼Œä»¥åŠæ€§èƒ½ä¼˜åŒ–ã€‚æ¥ä¸‹æ¥éœ€è¦ç”¨æˆ·å…·ä½“è¯´æ˜é‡åˆ°çš„é—®é¢˜æˆ–é¢„æœŸç›®æ ‡ï¼Œæ‰èƒ½è¿›ä¸€æ­¥é’ˆå¯¹æ€§åˆ†æå¹¶æä¾›è§£å†³æ–¹æ¡ˆã€‚
>
> 



å¥½çš„ï¼Œè®©æˆ‘ç»“åˆä»£ç ç»“æ„å’Œä½ æä¾›çš„ä¸šåŠ¡ç›®æ ‡ï¼Œåˆ†ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†è¯¦ç»†åˆ†ææ ‡å°ºæ’ä»¶çš„å®ç°ï¼Œå¹¶æŒ‡å‡ºå¯ä»¥ä¼˜åŒ–çš„å…³é”®ç‚¹ï¼š

---

### ä¸€ã€æ¨¡å—èŒè´£æ‹†åˆ†åˆ†æ
#### 1. index.ts - æ ¸å¿ƒå…¥å£æ¨¡å—
- **åŠŸèƒ½**ï¼š 
  - åˆ›å»ºCanvasRulerå®ä¾‹å¹¶æ³¨å…¥Fabric.jsç”»å¸ƒå¯¹è±¡
  - å¤„ç†è¾…åŠ©çº¿ï¼ˆGuidelineï¼‰çš„**æ‹–æ‹½è¾¹ç•Œåˆ¤æ–­**ä¸**è¶Šç•Œåˆ é™¤**é€»è¾‘
  - é€šè¿‡äº‹ä»¶ç›‘å¬`guideline:moving`å’Œ`guideline:mouseup`å®ç°äº¤äº’è§„åˆ™
- **å…³é”®é€»è¾‘è§£è¯»**ï¼š
  - `getWorkspace()` é€šè¿‡IDæŸ¥æ‰¾å·¥ä½œåŒºå¯¹è±¡ï¼ˆå¯èƒ½å­˜åœ¨éšæ‚£ï¼Œè‹¥æœªè®¾ç½®IDå°†å¤±æ•ˆï¼‰
  - `isRectOut()` ä½¿ç”¨`getBoundingRect()`åˆ¤æ–­è¾…åŠ©çº¿æ˜¯å¦è¶…å‡ºworkspaceèŒƒå›´
  - å½“æ£€æµ‹åˆ°è¶Šç•Œæ—¶ï¼š
    ```typescript
    target.moveCursor = 'not-allowed'; // æ›´æ”¹é¼ æ ‡æ ·å¼ä¸ºç¦ç”¨
    canvas.remove(target); // ç›´æ¥åˆ é™¤è¾…åŠ©çº¿
    ```

#### 2. types.d.ts - ç±»å‹å¢å¼ºæ¨¡å—
- **åŠŸèƒ½æ‰©å±•**ï¼š
  - ä¸ºFabric.jså£°æ˜**è¾…åŠ©çº¿ï¼ˆGuidelineï¼‰**çš„è‡ªå®šä¹‰ç±»å‹
  - æ‰©å±•Canvasç±»å‹çš„`ruler`å±æ€§ï¼Œå°†æ ‡å°ºå®ä¾‹æŒ‚è½½åˆ°ç”»å¸ƒå¯¹è±¡ä¸Š
  - äº‹ä»¶ç±»å‹çš„å¢å¼ºï¼š`guideline:moving`å’Œ`guideline:mouseup`
- **ç—›ç‚¹åˆ¤æ–­**ï¼š
  - è‹¥æœ‰ç±»å‹å£°æ˜ç¼ºå¤±ï¼ˆå¦‚`getBoundingRect()`è¿”å›çš„`Rect`ç»“æ„ï¼‰ï¼Œä¼šåœ¨TSç¼–è¯‘é˜¶æ®µæŠ¥é”™
  - `fire`å’Œ`on`æ–¹æ³•çš„äº‹ä»¶æ³›å‹éœ€è¦ä¸¥æ ¼åŒ¹é…ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´äº‹ä»¶å›è°ƒå‚æ•°ç±»å‹é”™è¯¯

#### 3. util.ts - å·¥å…·å‡½æ•°æ¨¡å—
- **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - `getGap()`ï¼šåŸºäºç¼©æ”¾çº§åˆ«åŠ¨æ€è®¡ç®—æ ‡å°ºåˆ»åº¦é—´éš”ï¼Œä¿æŒåˆ»åº¦åˆç†æ€§
  - `mergeLines()`ï¼šåˆå¹¶ç›¸é‚»çº¿æ®µé¿å…é‡å ï¼Œä¼˜åŒ–æ ‡å°ºæ¸²æŸ“æ€§èƒ½
  - ç»˜å›¾è¾…åŠ©å‡½æ•°ï¼š`darwLine`ã€`darwText`ã€`darwRect`ã€`drawMask`
- **ä¼˜åŒ–é™·è¿›æç¤º**ï¼š
  1. **`getGap()`çš„å‚æ•°è¡¨å¯¹é½**  
     å½“å‰æ³¨é‡Šæ‰çš„`zooms`å’Œ`gaps`ä¸å¯ç”¨æ•°ç»„å­˜åœ¨ä¸åŒ¹é…å¯èƒ½å¯¼è‡´åˆ»åº¦è·³è·ƒå¼å˜åŒ–
     ```typescript
     const zooms = [0.02, 0.05, 0.1, 0.2, 0.5, 2, 5, 10]; // é€’å¢ä¸è¿ç»­ï¼ˆç¼ºå°‘0.03ï¼‰
     const gaps = [1000, 250, 100, 50, 25, 10, 2.5, 1]     // é•¿åº¦åŒ¹é…ä½†ä¸­é—´æ®µå¯èƒ½çªå…€
     ```
  2. **`mergeLines()`çš„åˆå¹¶ç®—æ³•**  
     å½“çº¿æ®µé—´éš”è¶…è¿‡åˆå¹¶é˜ˆå€¼æ—¶å¯èƒ½äº§ç”Ÿæœªé¢„æœŸçš„åˆ†æ®µéœ€è¦è¾¹ç•Œæ¡ä»¶æµ‹è¯•

---

### äºŒã€å…³é”®ä»£ç é€»è¾‘ç‚¹è¯„ & ä¼˜åŒ–å»ºè®®
#### 1. è¾…åŠ©çº¿è¶Šç•Œåˆ é™¤é€»è¾‘ï¼ˆindex.tsï¼‰
- **ç°æœ‰é€»è¾‘çš„ä¸è¶³**ï¼š
  - **`getWorkspace`ä»…åœ¨äº‹ä»¶è§¦å‘æ—¶å»¶è¿Ÿè·å–**  
    é¦–æ¬¡æ‹–æ‹½æ—¶å¯èƒ½å› `workspace`æœªåˆå§‹åŒ–å¯¼è‡´è¯¯åˆ¤
  - **åæ ‡ç³»è½¬æ¢ç¼ºå¤±**  
    æœªè€ƒè™‘ç”»å¸ƒçš„`viewportTransform`ï¼ˆå¹³ç§»/ç¼©æ”¾ï¼‰ï¼Œéœ€è½¬æ¢åˆ°ç»å¯¹åæ ‡åˆ¤æ–­

- **ä¼˜åŒ–æ–¹æ¡ˆç¤ºä¾‹**ï¼š
```typescript
// åœ¨åˆå§‹åŒ–æ—¶ä¸»åŠ¨è·å–workspaceï¼Œå¢åŠ å…œåº•åˆ¤æ–­
const workspace = canvas.getObjects().find(item => item.id === WorkspaceID.WorkspaceCavas);
if (!workspace) { 
  throw new Error('Workspace object not found!');
}

// ä¿®æ”¹isRectOutï¼Œè€ƒè™‘ç”»å¸ƒå˜æ¢
const isRectOut = (object: fabric.Object, target: fabric.GuideLine) => {
  const objRect = object.getBoundingRect(true, true); // ç»å¯¹åæ ‡
  const targetRect = target.getBoundingRect(true, true); 

  // ç”¨ç»å¯¹åæ ‡æ¯”è¾ƒ...
}
```

#### 2. æ ‡å°ºåˆ»åº¦è®¡ç®—ï¼ˆutil.tsï¼‰
- **åŠ¨æ€é—´éš”çš„éšæ‚£**ï¼š  
  å½“`zoom`æ°å¥½ç­‰äº`zooms`æ•°ç»„ä¸­çš„æŸä¸ªå€¼æ—¶ï¼Œ`i++`å¯¼è‡´å‘åå¤šè·³ä¸€ä½ï¼Œå»ºè®®ä½¿ç”¨`<=`åˆ¤æ–­ï¼š
```typescript
while (i < zooms.length && zooms[i] <= zoom) { // ä¿®æ”¹æ¡ä»¶
  i++;
}
return gaps[i] || gaps[gaps.length - 1]; // è¿”å›å½“å‰iå¯¹åº”çš„å€¼
```

#### 3. æ€§èƒ½ä¼˜åŒ–å»ºè®®
- **é˜²æŠ–å¤„ç†é«˜é¢‘äº‹ä»¶**ï¼š  
  åœ¨`guideline:moving`äº‹ä»¶ä¸­æ·»åŠ é˜²æŠ–ï¼Œé¿å…é¢‘ç¹é‡ç»˜ã€‚
  ```typescript
  import { debounce } from 'lodash-es';
  canvas.on('guideline:moving', debounce(handleMoving, 50));
  ```

- **ä½¿ç”¨ç¼“å­˜ä¼˜åŒ–ç»˜å›¾**ï¼š  
  æ ‡å°ºçš„æ¸²æŸ“ç»“æœå¯ä»¥ç¼“å­˜åœ¨ç¦»å±Canvasä¸­ï¼Œå½“ç¼©æ”¾ç­‰çº§æœªæ”¹å˜æ—¶å¤ç”¨ã€‚

---

### ä¸‰ã€æ½œåœ¨é£é™©åŠè§£å†³æ–¹æ¡ˆ
#### 1. ç±»å‹å£°æ˜ä¸å®Œæ•´ï¼ˆtypes.d.tsï¼‰
- **é—®é¢˜ç¤ºä¾‹**ï¼š  
  ç¼ºå°‘`isHorizontal()`æ–¹æ³•åœ¨`GuideLine`æ¥å£ä¸­çš„å£°æ˜ï¼Œå¯¼è‡´`target.isHorizontal()`æŠ¥é”™ã€‚
- **ä¿®å¤æ–¹å¼**ï¼šç¡®ä¿æ‰€æœ‰è‡ªå®šä¹‰æ–¹æ³•éƒ½æœ‰å¯¹åº”çš„typeå®šä¹‰ã€‚

#### 2. Fabricç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜
- **éªŒè¯å»ºè®®**ï¼šç¡®è®¤æ’ä»¶ä¾èµ–çš„Fabricç‰ˆæœ¬ï¼ˆå¦‚5.x/6.xï¼‰ï¼Œè°ƒæ•´`viewportTransform`ç­‰APIçš„è°ƒç”¨æ–¹å¼ã€‚

#### 3. è¾…åŠ©çº¿æŒä¹…åŒ–
- **ä¸šåŠ¡åœºæ™¯éœ€æ±‚**ï¼šè‹¥éœ€è¦ä¿å­˜/åŠ è½½è¾…åŠ©çº¿ï¼Œéœ€æ‰©å±•`GuideLine`çš„åºåˆ—åŒ–æ–¹æ³•ï¼ˆ`toObject/fromObject`ï¼‰ã€‚

---

### å››ã€æ‰©å±•æ€§è®¾è®¡å»ºè®®
1. **å¯é…ç½®åŒ–å‚æ•°**ï¼š  
   é€šè¿‡`RulerOptions`æš´éœ²æ›´å¤šæ ·å¼é€‰é¡¹ï¼ˆå¦‚æ ‡å°ºé¢œè‰²ã€å­—ä½“å¤§å°ï¼‰ã€‚
2. **è‡ªå®šä¹‰æ ‡å°ºä½ç½®**ï¼š  
   æ”¯æŒä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘çš„æ ‡å°ºï¼Œè€Œéå½“å‰çš„æ°´å¹³/å‚ç›´é™å®šã€‚
3. **äº‹ä»¶é’©å­æ³¨å…¥**ï¼š  
   æ·»åŠ `onGuidelineRemoved`ç­‰å›è°ƒï¼Œä¾›å¤–éƒ¨ç›‘å¬è¾…åŠ©çº¿å˜åŒ–ã€‚

---

å¦‚æœéœ€è¦è¿›ä¸€æ­¥åˆ†ææŸä¸ªå…·ä½“é—®é¢˜çš„å®ç°ç»†èŠ‚ï¼ˆå¦‚åŠ¨æ€ç¼©æ”¾æ—¶æ ‡å°ºçš„æ›´æ–°æœºåˆ¶ï¼‰ï¼Œå¯ä»¥å‘ŠçŸ¥æˆ‘å…·ä½“éœ€æ±‚ï¼Œæˆ‘å°†æä¾›é’ˆå¯¹æ€§ä»£ç è§£æï¼
