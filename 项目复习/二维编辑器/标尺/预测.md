> ğŸ’­ å¥½çš„ï¼Œæˆ‘éœ€è¦åˆ†æç”¨æˆ·ä¹‹å‰æä¾›çš„Fabric.jsæ ‡å°ºæ’ä»¶ä»£ç ï¼Œå¹¶é¢„æµ‹å‰ç«¯é¢è¯•å®˜å¯èƒ½æå‡ºçš„é—®é¢˜ï¼ŒåŒæ—¶ç»™å‡ºè¯¦ç»†çš„è§£ç­”ã€‚é¦–å…ˆï¼Œæˆ‘è¦ä»”ç»†é˜…è¯»ç”¨æˆ·æä¾›çš„ä»£ç ï¼Œäº†è§£å…¶ç»“æ„ã€åŠŸèƒ½ä»¥åŠä½¿ç”¨çš„å…³é”®æŠ€æœ¯ç‚¹ã€‚
>
> ç”¨æˆ·ä¹‹å‰å¯èƒ½å‘é€çš„ä»£ç æ¶‰åŠåœ¨Fabric.jsç”»å¸ƒä¸Šæ·»åŠ æ ‡å°ºåŠŸèƒ½ï¼Œå¯èƒ½åŒ…æ‹¬äº†ç»˜åˆ¶æ ‡å°ºã€å¤„ç†æ»šåŠ¨äº‹ä»¶ã€æ›´æ–°æ ‡å°ºåˆ»åº¦ç­‰éƒ¨åˆ†ã€‚å¸¸è§çš„å…³æ³¨ç‚¹å¯èƒ½åŒ…æ‹¬ï¼šäº‹ä»¶å¤„ç†ã€æ€§èƒ½ä¼˜åŒ–ã€ä¸Fabric.jsçš„é›†æˆæ–¹å¼ã€ä»£ç çš„å¯ç»´æŠ¤æ€§ã€æµè§ˆå™¨å…¼å®¹æ€§ç­‰ã€‚
>
> é¦–å…ˆï¼Œé¢è¯•å®˜å¯èƒ½ä¼šè¯¢é—®äº‹ä»¶ç›‘å¬éƒ¨åˆ†ï¼Œå°¤å…¶æ˜¯å¦‚ä½•å¤„ç†æ»šåŠ¨å’Œç¼©æ”¾äº‹ä»¶ï¼Œä»¥åŠå¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼Œé¿å…é¢‘ç¹çš„é‡ç»˜ã€‚æ¥ç€ï¼Œå…³äºå¦‚ä½•åŠ¨æ€è®¡ç®—å’Œæ›´æ–°æ ‡å°ºçš„åˆ»åº¦ï¼Œå¯èƒ½æ¶‰åŠç®—æ³•å’Œæ•°å­¦è®¡ç®—ã€‚æ­¤å¤–ï¼Œä»£ç ç»“æ„è®¾è®¡æ–¹é¢ï¼Œå¦‚ç±»çš„å°è£…ã€æ–¹æ³•çš„åˆ†å·¥ï¼Œä¹Ÿæ˜¯å¸¸è§çš„è€ƒå¯Ÿç‚¹ã€‚
>
> è¿˜å¯èƒ½é—®åˆ°ä¸Fabric.jså†…éƒ¨æœºåˆ¶çš„ç»“åˆï¼Œä¾‹å¦‚è·å–ç”»å¸ƒè§†å£å˜æ¢åçš„åæ ‡ï¼Œå¤„ç†ç¼©æ”¾å’Œå¹³ç§»åçš„æ­£ç¡®æ ‡å°ºæ˜¾ç¤ºã€‚æ­¤å¤–ï¼Œä»£ç çš„æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæ¯”å¦‚å¦‚ä½•è®©å…¶ä»–å¼€å‘è€…è½»æ¾ä½¿ç”¨è¯¥æ’ä»¶ï¼Œæˆ–è€…å¦‚ä½•æ”¯æŒè‡ªå®šä¹‰æ ·å¼ç­‰ã€‚
>
> å¦å¤–ï¼Œé¢è¯•å®˜å¯èƒ½ä¼šå…³æ³¨è¾¹ç•Œæƒ…å†µçš„å¤„ç†ï¼Œä¾‹å¦‚ç”»å¸ƒæå¤§æˆ–æå°æ—¶çš„æ ‡å°ºè¡¨ç°ï¼Œæˆ–è€…é«˜DPIå±å¹•çš„é€‚é…é—®é¢˜ã€‚æœ€åï¼Œæµ‹è¯•å’Œè°ƒè¯•æ–¹æ³•ï¼Œå¦‚ä½•éªŒè¯æ ‡å°ºåœ¨å„ç§åœºæ™¯ä¸‹çš„æ­£ç¡®æ€§ï¼Œä¹Ÿæ˜¯æ½œåœ¨çš„é—®é¢˜ç‚¹ã€‚
>
> æˆ‘éœ€è¦ç¡®ä¿æ¯ä¸ªé—®é¢˜è§£ç­”éƒ½è¯¦ç»†ä¸”æ¡ç†æ¸…æ™°ï¼Œæ¶µç›–åŸç†ã€å®ç°ç»†èŠ‚ä»¥åŠå¯èƒ½çš„ä¼˜åŒ–æ–¹å‘ã€‚åŒæ—¶ï¼Œè¯­è¨€è¦ç®€æ˜æ˜“æ‡‚ï¼Œç¬¦åˆæŠ€æœ¯é¢è¯•çš„åº”ç­”è¦æ±‚ã€‚éœ€è¦æ£€æŸ¥æ˜¯å¦æœ‰é—æ¼çš„å…³é”®ç‚¹ï¼Œå¦‚æ€§èƒ½ç›¸å…³çš„èŠ‚æµï¼ˆthrottleï¼‰æˆ–é˜²æŠ–ï¼ˆdebounceï¼‰æŠ€æœ¯ï¼ŒCanvasç»˜åˆ¶çš„ä¼˜åŒ–ç­–ç•¥ï¼Œæˆ–è€…æ˜¯å¦‚ä½•é¿å…å†…å­˜æ³„æ¼ç­‰ã€‚
>
> æ€»ç»“æ¥è¯´ï¼Œæˆ‘éœ€è¦ä»äº‹ä»¶å¤„ç†ã€ç»˜å›¾é€»è¾‘ã€æ¡†æ¶é›†æˆã€æ€§èƒ½ä¼˜åŒ–ã€ä»£ç è®¾è®¡ã€ç”¨æˆ·ä½“éªŒç­‰å‡ ä¸ªæ–¹é¢å…¨é¢åˆ†æå¯èƒ½çš„æé—®ï¼Œå¹¶ä¸ºæ¯ä¸ªé—®é¢˜å‡†å¤‡æ·±å…¥çš„è§£é‡Šå’Œç¤ºä¾‹ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿåº”å¯¹å‰ç«¯é¢è¯•ä¸­çš„æŠ€æœ¯è€ƒå¯Ÿã€‚
>
> 



åœ¨åˆ†æä½ ä¹‹å‰æä¾›çš„ **Fabric.js æ ‡å°ºæ’ä»¶ä»£ç **åï¼Œä»¥ä¸‹æ˜¯å‰ç«¯é¢è¯•å®˜å¯èƒ½æå‡ºçš„é—®é¢˜åŠè¯¦ç»†è§£ç­”ï¼š

---

### **1. ä»£ç è®¾è®¡ä¸æ¶æ„**
#### **Q: ä¸ºä»€ä¹ˆè¦å°†æ ‡å°ºåŠŸèƒ½å°è£…æˆä¸€ä¸ªç±»ï¼ˆå¦‚ `CanvasRuler`ï¼‰ï¼Ÿæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ**
**ç­”ï¼š**  
å°†æ ‡å°ºåŠŸèƒ½å°è£…æˆç±»çš„æ ¸å¿ƒç›®çš„æ˜¯å®ç° **é«˜å†…èšã€ä½è€¦åˆ**ï¼Œå…·ä½“ä¼˜åŠ¿åŒ…æ‹¬ï¼š  
1. **å¤ç”¨æ€§**ï¼šå¯ä»¥åœ¨å¤šä¸ªç”»å¸ƒå®ä¾‹ä¸­å¤ç”¨æ ‡å°ºï¼Œè€Œæ— éœ€é‡å¤ç¼–å†™ä»£ç ã€‚  
2. **ç»´æŠ¤æ€§**ï¼šæ‰€æœ‰ä¸æ ‡å°ºç›¸å…³çš„é€»è¾‘ï¼ˆç»˜å›¾ã€äº‹ä»¶ç›‘å¬ï¼‰é›†ä¸­åœ¨ç±»å†…éƒ¨ï¼Œä¿®æ”¹æ—¶æ— éœ€å½±å“å¤–éƒ¨ä»£ç ã€‚  
3. **æ‰©å±•æ€§**ï¼šé€šè¿‡ç±»æ–¹æ³•æš´éœ²å¿…è¦çš„æ¥å£ï¼ˆå¦‚ `updateRuler`ï¼‰ï¼Œæ–¹ä¾¿åç»­æ·»åŠ æ–°åŠŸèƒ½ï¼ˆå¦‚è‡ªå®šä¹‰åˆ»åº¦æ ·å¼ï¼‰ã€‚  
4. **æ¸…æ™°æ€§**ï¼šé€šè¿‡æ„é€ å‡½æ•°åˆå§‹åŒ–é…ç½®ï¼ˆå¦‚æ–¹å‘ã€ç”»å¸ƒå¼•ç”¨ï¼‰ï¼Œä»£ç ç»“æ„æ›´æ¸…æ™°ã€‚

**ç¤ºä¾‹ä»£ç ç‰‡æ®µï¼š**
```javascript
class CanvasRuler {
  constructor(options) {
    this.canvas = options.canvas; // ä¾èµ–æ³¨å…¥
    this.direction = options.direction; // æ°´å¹³æˆ–å‚ç›´æ ‡å°º
    this.initEventListeners(); // äº‹ä»¶ç›‘å¬é›†ä¸­ç®¡ç†
  }
}
```

---

### **2. æ€§èƒ½ä¼˜åŒ–**
#### **Q: åœ¨æ»šåŠ¨æˆ–ç¼©æ”¾æ—¶ï¼Œå¦‚ä½•é¿å…é¢‘ç¹é‡ç»˜æ ‡å°ºå¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼Ÿ**
**ç­”ï¼š**  
å…³é”®ç­–ç•¥æ˜¯ **å‡å°‘é‡ç»˜é¢‘ç‡** å’Œ **ä¼˜åŒ–ç»˜å›¾è®¡ç®—**ï¼š  
1. **èŠ‚æµï¼ˆThrottleï¼‰**ï¼šä½¿ç”¨ `requestAnimationFrame` æˆ– Lodash çš„ `_.throttle` æ§åˆ¶äº‹ä»¶å›è°ƒçš„é¢‘ç‡ï¼Œç¡®ä¿é‡ç»˜é—´éš”åˆç†ï¼ˆå¦‚æ¯ 16ms ä¸€æ¬¡ï¼‰ã€‚  
2. **è„çŸ©å½¢æ£€æµ‹**ï¼šåªé‡ç»˜æ ‡å°ºä¸­å‘ç”Ÿå˜åŒ–çš„åŒºåŸŸï¼ˆå¦‚è§†å£ç§»åŠ¨åçš„æ–°æ—§é‡å åŒºåŸŸï¼‰ï¼Œè€Œéæ•´ä¸ªæ ‡å°ºã€‚  
3. **ç¼“å­˜ç»˜åˆ¶ç»“æœ**ï¼šè‹¥æ ‡å°ºçš„é™æ€éƒ¨åˆ†ï¼ˆå¦‚èƒŒæ™¯è‰²ï¼‰ä¸å˜ï¼Œå¯å°†å…¶ç¼“å­˜ä¸ºç¦»å± Canvasï¼Œé¿å…é‡å¤ç»˜åˆ¶ã€‚

**ç¤ºä¾‹ï¼š**
```javascript
// ä½¿ç”¨ requestAnimationFrame èŠ‚æµ
onScroll() {
  if (this.rafPending) return;
  this.rafPending = true;
  requestAnimationFrame(() => {
    this.updateRuler(); // å®é™…æ›´æ–°é€»è¾‘
    this.rafPending = false;
  });
}
```

---

### **3. åæ ‡ç³»ä¸æ•°å­¦è®¡ç®—**
#### **Q: å¦‚ä½•æ ¹æ®ç”»å¸ƒçš„è§†å£å˜æ¢ï¼ˆå¹³ç§»ã€ç¼©æ”¾ï¼‰åŠ¨æ€è®¡ç®—æ ‡å°ºçš„åˆ»åº¦å’Œä½ç½®ï¼Ÿ**
**ç­”ï¼š**  
éœ€ç»“åˆ Fabric.js çš„è§†å£çŸ©é˜µï¼ˆ`viewportTransform`ï¼‰è¿›è¡Œè®¡ç®—ï¼š  
1. **è§†å£å˜æ¢è§£æ**ï¼š  
   - `viewportTransform` æ˜¯ä¸€ä¸ª 3x3 çŸ©é˜µï¼Œè¡¨ç¤ºç”»å¸ƒçš„å¹³ç§»å’Œç¼©æ”¾ã€‚  
   - è®¡ç®—å½“å‰è§†å£çš„ `offsetX` å’Œ `offsetY`ï¼ˆå¹³ç§»é‡ï¼‰ï¼Œä»¥åŠ `scale`ï¼ˆç¼©æ”¾å€æ•°ï¼‰ã€‚  
2. **åˆ»åº¦å®šä½**ï¼š  
   - æ ¹æ®è§†å£çš„åç§»é‡åå‘è®¡ç®—æ ‡å°ºåŸç‚¹çš„ä½ç½®ï¼Œç¡®ä¿æ ‡å°ºä¸ç”»å¸ƒå†…å®¹åŒæ­¥æ»šåŠ¨ã€‚  
   - åŠ¨æ€è°ƒæ•´åˆ»åº¦é—´éš”ï¼ˆå¦‚æ ¹æ®ç¼©æ”¾çº§åˆ«é€‰æ‹©é—´éš”ä¸º 50ã€100ã€200 åƒç´ ï¼‰ã€‚  

**è®¡ç®—ç¤ºä¾‹ï¼š**
```javascript
// è·å–è§†å£åç§»å’Œç¼©æ”¾æ¯”ä¾‹
const vpt = canvas.viewportTransform;
const offsetX = vpt[4];
const offsetY = vpt[5];
const scale = canvas.getZoom();

// è®¡ç®—æ ‡å°ºèµ·ç‚¹ï¼ˆè€ƒè™‘æ–¹å‘ï¼‰
const startPos = this.direction === 'horizontal' 
  ? -offsetX / scale 
  : -offsetY / scale;

// åŠ¨æ€è°ƒæ•´åˆ»åº¦é—´éš”
let tickInterval = 50;
if (scale < 0.5) tickInterval = 100;
else if (scale > 2) tickInterval = 20;
```

---

### **4. äº‹ä»¶å¤„ç†**
#### **Q: ä¸ºä»€ä¹ˆåœ¨æ ‡å°ºä¸Šç›‘å¬ `mouse:down` äº‹ä»¶ï¼Ÿå¦‚ä½•å¤„ç†æ‹–æ‹½ç”»å¸ƒä»¥å¤–çš„äº¤äº’ï¼Ÿ**
**ç­”ï¼š**  
1. **ç›‘å¬ `mouse:down`**ï¼š  
   - å…è®¸ç”¨æˆ·é€šè¿‡ç‚¹å‡»æ ‡å°ºåŒºåŸŸè§¦å‘ç‰¹å®šæ“ä½œï¼ˆå¦‚å¿«é€Ÿå®šä½ç”»å¸ƒåˆ°æŸä¸ªåˆ»åº¦ï¼‰ã€‚  
2. **æ‹–æ‹½äº¤äº’æ‰©å±•**ï¼š  
   - å¯å°†æ ‡å°ºä½œä¸ºæ‹–æ‹½èµ·å§‹ç‚¹ï¼Œç»“åˆ `mouse:move` å’Œ `mouse:up` å®ç°è‡ªå®šä¹‰äº¤äº’ï¼ˆå¦‚æ·»åŠ å‚è€ƒçº¿ï¼‰ã€‚  
   - æ³¨æ„äº‹ä»¶å§”æ‰˜å’Œå¯¹è±¡å”¯ä¸€æ€§åˆ¤æ–­ï¼ˆå¦‚åŒºåˆ†æ ‡å°ºç‚¹å‡»å’Œç”»å¸ƒå†…éƒ¨å¯¹è±¡ç‚¹å‡»ï¼‰ã€‚

**ç¤ºä¾‹ï¼š**
```javascript
// æ ‡å°ºç‚¹å‡»äº‹ä»¶å¤„ç†
canvas.on('mouse:down', (e) => {
  if (e.target || !this.isOverRuler(e.absolutePointer)) return;
  // å¤„ç†æ ‡å°ºç‚¹å‡»é€»è¾‘ï¼ˆå¦‚åˆ›å»ºå‚è€ƒçº¿ï¼‰
});
```

---

### **5. Canvas ç»˜åˆ¶ç»†èŠ‚**
#### **Q: ä¸ºä»€ä¹ˆåœ¨ç»˜åˆ¶åˆ»åº¦æ—¶é‡‡ç”¨ä»ä¸­å¿ƒå‘ä¸¤ä¾§æ‰©æ•£çš„ç­–ç•¥ï¼Ÿ**
**ç­”ï¼š**  
è¿™æ˜¯ä¸ºäº† **ä¼˜åŒ–ç»˜åˆ¶æ€§èƒ½** å’Œ **é¿å…é‡å¤è®¡ç®—**ï¼š  
1. **å‡å°‘å¾ªç¯æ¬¡æ•°**ï¼šä»ä¸­å¿ƒç‚¹å‘ä¸¤ä¾§ç»˜åˆ¶ï¼Œåˆ©ç”¨å¯¹ç§°æ€§å‡å°‘éå†æ¬¡æ•°ã€‚  
2. **å¤„ç†è§†å£ç§»åŠ¨**ï¼šæ— è®ºç”»å¸ƒå¦‚ä½•æ»šåŠ¨ï¼Œåªéœ€åŸºäºå½“å‰è§†å£çš„ä¸­å¿ƒç‚¹æ‰©æ•£ï¼Œç®—æ³•å§‹ç»ˆæœ‰æ•ˆã€‚

**ä»£ç é€»è¾‘ç¤ºä¾‹ï¼š**
```javascript
// æ‰¾åˆ°è§†å£ä¸­å¿ƒç‚¹é™„è¿‘çš„ç¬¬ä¸€ä¸ªåˆ»åº¦
let currentTick = Math.floor(startPos / tickInterval) * tickInterval;

// å‘å·¦/ä¸Šç»˜åˆ¶
while (currentTick > startPos - tickInterval * 10) {
  drawTick(currentTick);
  currentTick -= tickInterval;
}

// å‘å³/ä¸‹ç»˜åˆ¶
currentTick = Math.floor(startPos / tickInterval) * tickInterval + tickInterval;
while (currentTick < startPos + visibleLength) {
  drawTick(currentTick);
  currentTick += tickInterval;
}
```

---

### **6. ä¸ Fabric.js çš„æ•´åˆ**
#### **Q: ä¸ºä»€ä¹ˆåœ¨ `updateRuler` ä¸­éœ€è¦è°ƒç”¨ `calcViewportBoundaries`ï¼Ÿå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ**
**ç­”ï¼š**  
1. **ä½œç”¨**ï¼š  
   `calcViewportBoundaries` è®¡ç®—ç”»å¸ƒè§†å£åœ¨å½“å‰å¹³ç§»å’Œç¼©æ”¾åçš„å¯è§†åŒºåŸŸåæ ‡èŒƒå›´ï¼Œç”¨äºç¡®å®šæ ‡å°ºçš„åˆ»åº¦æ˜¾ç¤ºèŒƒå›´ã€‚  
2. **å®ç°ç»†èŠ‚**ï¼š  
   - æ ¹æ®è§†å£çŸ©é˜µï¼ˆ`viewportTransform`ï¼‰åå‘è®¡ç®—è§†å£çš„å·¦ä¸Šè§’å’Œå³ä¸‹è§’åæ ‡ã€‚  
   - ç»“åˆç”»å¸ƒå°ºå¯¸ï¼ˆ`width`/`height`ï¼‰å’Œç¼©æ”¾æ¯”ï¼ˆ`zoom`ï¼‰ç¡®å®šå®é™…å¯è§åŒºåŸŸã€‚

**æ•°å­¦æ¨å¯¼ç¤ºä¾‹ï¼š**
```javascript
// è®¡ç®—è§†å£å·¦ä¸Šè§’åæ ‡
const minX = -vpt[4] / scale;
const minY = -vpt[5] / scale;

// è®¡ç®—è§†å£å³ä¸‹è§’åæ ‡
const maxX = minX + canvas.width / scale;
const maxY = minY + canvas.height / scale;
```

---

### **7. è¾¹ç•Œæƒ…å†µä¸å¼‚å¸¸å¤„ç†**
#### **Q: å¦‚ä½•å¤„ç†ç”»å¸ƒæ— é™æ”¾å¤§æˆ–ç¼©å°æ—¶çš„æ ‡å°ºæ˜¾ç¤ºï¼Ÿ**
**ç­”ï¼š**  
éœ€å¢åŠ  **è¾¹ç•Œæ ¡éªŒ** å’Œ **ä¿æŠ¤æ€§åˆ¤æ–­**ï¼š  
1. **é™åˆ¶ç¼©æ”¾èŒƒå›´**ï¼šåœ¨ Fabric.js é…ç½®ä¸­è®¾ç½® `minZoom` å’Œ `maxZoom`ã€‚  
2. **åˆ»åº¦åŠ¨æ€å¯†åº¦**ï¼šæ ¹æ®å½“å‰ç¼©æ”¾çº§åˆ«åŠ¨æ€è°ƒæ•´åˆ»åº¦é—´éš”ï¼Œé¿å…è¿‡å¯†æˆ–è¿‡ç–ã€‚  
3. **æ€§èƒ½å…œåº•**ï¼šåœ¨æç«¯ç¼©æ”¾çº§åˆ«ä¸‹ï¼Œé™çº§ç»˜åˆ¶ç®€å•åˆ»åº¦æˆ–æš‚åœæ›´æ–°ã€‚

**ç¤ºä¾‹é…ç½®ï¼š**
```javascript
canvas.set({
  minZoom: 0.1,
  maxZoom: 20,
});
```

---

### **æ€»ç»“**
é¢è¯•å®˜ä¼šå›´ç»•ä»¥ä¸‹æ–¹å‘æ·±å…¥æé—®ï¼š  
1. **ä»£ç è®¾è®¡**ï¼šç±»çš„å°è£…ã€æ–¹æ³•èŒè´£åˆ’åˆ†ã€æ‰©å±•æ€§è®¾è®¡ã€‚  
2. **æ ¸å¿ƒç®—æ³•**ï¼šè§†å£åæ ‡è®¡ç®—ã€åˆ»åº¦åŠ¨æ€è°ƒæ•´ç­–ç•¥ã€‚  
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šé‡ç»˜é¢‘ç‡æ§åˆ¶ã€Canvas ç»˜åˆ¶ä¼˜åŒ–ã€‚  
4. **æ¡†æ¶é›†æˆ**ï¼šæ·±å…¥ç†è§£ Fabric.js çš„è§†å£æœºåˆ¶å’Œäº‹ä»¶ç³»ç»Ÿã€‚  

ç¡®ä¿åœ¨å›ç­”æ—¶ç»“åˆä»£ç ç»†èŠ‚ï¼Œå±•ç°å¯¹é—®é¢˜çš„å…¨é¢åˆ†æå’Œå®é™…è§£å†³èƒ½åŠ›ã€‚
