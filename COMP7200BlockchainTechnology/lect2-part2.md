### 迪菲 - 赫尔曼密钥交换
- 爱丽丝有私钥$X_A$和公钥$Y_A$，她计算：
- 鲍勃有私钥$X_B$和公钥$Y_B$，他计算：
\[K = Y_B^{X_A} \text{ mod } p\]
\[K' = Y_A^{X_B} \text{ mod } p\]
$K$ 是（鲍勃的公钥）的（爱丽丝的私钥）次方 再对 $p$ 取模
$K'$ 是（爱丽丝的公钥）的（鲍勃的私钥）次方 再对 $p$ 取模
### 迪菲 - 赫尔曼密钥交换
- 爱丽丝计算：
- 爱丽丝有私钥$X_A$和公钥$Y_A$，展开计算：
- 鲍勃有公钥$Y_B$，他计算：
\[K = Y_B^{X_A} \text{ mod } p\]
\[K' = Y_A^{X_B} \text{ mod } p\]
- 鲍勃有私钥$X_B$，展开计算：
\[K = Y_B^{X_A} \text{ mod } p = (\alpha^{X_B} \text{ mod } p)^{X_A} \text{ mod } p = \alpha^{X_B X_A} \text{ mod } p\]
\[K' = Y_A^{X_B} \text{ mod } p = (\alpha^{X_A} \text{ mod } p)^{X_B} \text{ mod } p = \alpha^{X_A X_B} \text{ mod } p\]
$K$ 是只有鲍勃和爱丽丝知道的共享密钥
\[K = K'\]
### 迪菲 - 赫尔曼示例
假设$p = 31667$，$\alpha = 7$
爱丽丝选择：
鲍勃选择：
\[X_A = 18\]
\[X_B = 27\]
爱丽丝的公钥是：
鲍勃的公钥是：
\[Y_A = 7^{18} \text{ mod } 31667 = 6780\]
\[Y_B = 7^{27} \text{ mod } 31667 = 22184\]
\[K = 22184^{18} \text{ mod } 31667\]
\[K = 6780^{27} \text{ mod } 31667\]
\[K = 14265\]
\[K = 14265\]
### 密钥分发问题解决了！
- 用户保留私钥，将公钥发布在数据库（“电话簿”）中。
- 通信开始时进行密钥交换以建立共享密钥。
- 共享密钥可用于加密会话密钥，通过减少用其加密的数据量来增加破解共享密钥的难度。
- 会话密钥仅在一次通信会话中有效。
### RSA：公钥密码学
1977年，罗恩·李维斯特（Ron Rivest）、阿迪·沙米尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）创建了真正的公钥加密算法。
- 每个用户生成两个密钥：
    - 私钥（保密）。
    - 公钥。
- 该算法的难度基于分解大数字的难度。密钥是一对大质数（约200位）的函数 。
### RSA算法
#### 生成密钥：
- 选择两个随机的大质数$p$、$q$。
- 计算乘积$n = pq$。
- 随机选择加密密钥$e$，使得$e$与$(p - 1)(q - 1)$互质。
- 使用扩展欧几里得算法计算解密密钥$d$，满足$ed \equiv 1 \text{ mod } ((p - 1)(q - 1))$，即$d = e^{-1} \text{ mod } ((p - 1)(q - 1))$ 。
- 丢弃$p$、$q$。
### RSA算法
#### 加密：
- 将数据分成小于$n$的数字块。
- 对每个块进行加密：$c = m^e \text{ mod } n$。
#### 解密：
\[m = c^d \text{ mod } n\]
### 使用公钥算法进行通信
加密和解密使用不同的密钥，无需担心密钥分发问题。
### 使用公钥算法进行通信
爱丽丝和鲍勃交换公钥（或在目录/数据库中查找）。
爱丽丝的公钥：$K_A$
鲍勃的公钥：$K_B$
### 使用公钥算法进行通信
爱丽丝用鲍勃的公钥加密消息，鲍勃用自己的私钥解密消息。
爱丽丝  鲍勃
爱丽丝的公钥：$K_A$
鲍勃的公钥：$K_B$
加密消息  解密消息
用鲍勃的公钥  用鲍勃的私钥
### 使用公钥算法进行通信
爱丽丝和鲍勃可以双向通信，既可以用对方的公钥加密，也可以用自己的私钥签名。
爱丽丝  鲍勃
爱丽丝的公钥：$K_A$
鲍勃的公钥：$K_B$
加密消息  解密消息
用鲍勃的私钥  用鲍勃的公钥
解密消息  加密消息
用爱丽丝的私钥  用爱丽丝的公钥
### 公钥密码学的问题
公钥密码学虽然很好，但存在以下问题：
- 在软件中，RSA比DES慢约100倍，在硬件中慢约1000倍。
- 易受选择明文攻击。如果知道数据是$n$个消息中的一个，只需用接收者的公钥加密每个消息并进行比较 。
- 减少用任何给定密钥加密的数据量是个好主意，但生成RSA密钥在计算上非常耗时。
### 签名
我们使用签名是因为签名具有：
- 真实性。
- 不可伪造性。
- 不可否认性。
- 不可重用性。
- 使文档不可更改。
（来源：http://www.archives.gov/exhibits/charters/declaration.html ）
### 签名
我们使用签名的这些特性，但实际上：
- 真实性、不可伪造性、不可否认性、不可重用性、使文档不可更改这些特性并不完全成立。
- 那么，数字签名能做得更好吗？
### 数字签名 - 仲裁协议（使用对称加密）
依靠可信第三方（仲裁者）来验证消息。
特伦特是可信的，并且拥有每个人的密钥。
爱丽丝用自己的密钥加密消息并发送给特伦特。
### 仲裁协议
特伦特用爱丽丝的密钥解密消息，这验证了消息来自爱丽丝。他可以选择记录消息的哈希值以创建传输记录。
### 仲裁协议
特伦特用鲍勃的密钥加密消息并发送给鲍勃。
### 仲裁协议
鲍勃收到消息并解密。由于只有特伦特和鲍勃拥有鲍勃的密钥，所以消息一定来自特伦特。如果消息表明来自爱丽丝，那么我们相信特伦特，就认为消息确实来自爱丽丝。
### 数字签名 - 公钥密码学
用私钥加密消息就相当于签名！
### 数字签名 - 公钥密码学
- 如果爱丽丝向鲍勃发送二进制数据会怎样？鲍勃可能很难判断解密是否成功。
- 公钥加密比对称加密慢得多，如果消息很大怎么办？
- 如果我们不想隐藏消息，但又想要有效签名该怎么办？
### 数字签名 - 公钥密码学
- 创建消息的哈希值。
- 加密哈希值并与消息一起发送。
- 通过解密哈希值并与接收到的消息的哈希值进行比较来验证哈希值。
- 这样，签名就与消息分离了。
### 数字签名 - 公钥密码学
爱丽丝生成消息的哈希值。
### 数字签名 - 公钥密码学
爱丽丝用她的私钥加密哈希值。
### 数字签名 - 公钥密码学
爱丽丝将消息和加密的哈希值发送给鲍勃。
### 数字签名 - 公钥密码学
1. 鲍勃用爱丽丝的公钥解密哈希值。
2. 鲍勃计算爱丽丝发送的消息的哈希值。
### 数字签名 - 公钥密码学
如果两个哈希值匹配，那么加密的哈希值一定是爱丽丝生成的，签名有效。
### 公钥/私钥和数字签名演示
- 公钥/私钥对：https://andersbrownworth.com/blockchain/public-private-keys/keys
- 数字签名：https://andersbrownworth.com/blockchain/public-private-keys/signatures
### 密码学工具箱
- 对称加密。
- 公钥加密。
- 单向哈希函数。
- 随机数生成器。
- 随机数（Nonces）、会话密钥。
### 示例
- 密钥交换。
- 公钥密码学。
- 密钥交换 + 安全通信。
- 公钥 + 对称密码学。
- 认证。
- 随机数 + 加密。
- 消息认证码。
- 哈希。
- 数字签名。
- 哈希 + 加密。 
