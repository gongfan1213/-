# COMP4137区块链技术与应用 COMP7200区块链技术
讲师：戴宏宁博士（亨利）
## 第2讲 密码学
### 大纲
- 密码学简介
- 古典密码
- 计算机密码学
## 密码学≠安全性
- 密码学可能是安全系统的一个组成部分。
- 添加密码学并不一定能使系统变得安全。
## 术语
- 明文（也称纯文本）用消息M表示。
- 加密用函数E(M)表示，加密后产生的密文用C = E(M)表示。
- 解密是对密文进行处理，以获得原始消息M = D(C)。
- 密码：加密算法。
## 术语：密码类型
- 受限密码
- 对称算法
- 公钥算法
## 受限密码
### 秘密算法
- 存在泄露风险。
- 容易被逆向工程破解。
- 举例：HD DVD（2006年12月）和蓝光（2007年1月）加密算法、RC4算法、所有数字蜂窝加密算法、DVD和DIVX视频压缩加密、火线接口加密、恩尼格玛密码机、冷战期间北约和华约的所有加密算法。
## 密钥
顺带一提，上图是一把万能钥匙。详见http://en.wikipedia.org/wiki/Lock_bumping 。
## 密钥
来源：http://en.wikipedia.org/wiki/Pin_tumbler_lock
## 密钥
来源：http://en.wikipedia.org/wiki/Pin_tumbler_lock
## 密钥
- 我们了解其工作原理：
    - 优势。
    - 劣势。
- 基于这种理解，我们可以评估对该密钥和锁的信任程度。
来源：http://en.wikipedia.org/wiki/Pin_tumbler_lock
## 对称算法（秘密密钥）
C = E<sub>K</sub>(M)
M = D<sub>K</sub>(C)
## 公钥算法（公钥和私钥）
C<sub>1</sub> = E<sub>public</sub>(M)
M = D<sub>private</sub>(C<sub>1</sub>)
此外：
C<sub>2</sub> = E<sub>private</sub>(M)
M = D<sub>public</sub>(C<sub>2</sub>)
## 麦卡锡谜题（1958年）
- 两个国家处于战争状态。
- 一个国家向另一个国家派遣间谍。
- 为了安全返回，间谍必须向边防警卫提供密码。
- 间谍是可信的。
- 警卫之间会聊天，他们得到的信息可能会泄露。
### 挑战！
警卫如何在不知道密码的情况下验证一个人的身份？敌人不能利用警卫掌握的信息混入自己的间谍。
## 麦卡锡谜题的解决方案（迈克尔·拉宾，1958年）
使用单向函数B = f(A)：
- 警卫得到B。
- 敌人无法计算出A。
- 间谍给出A，警卫计算f(A)。
- 如果结果是B，则密码正确。
### 示例函数：平方取中
- 取一个100位的数字（A），并对其进行平方。
- 令B为200位结果的中间100位数字。
## 麦卡锡谜题示例（以一个18位数字为例）
A = 28940734978663777
A² = 83756614110525308948445338203501729
中间平方值，B = 110525308948445338
已知A，计算B很容易；已知B，计算A极其困难。
## 单向函数
- 正向计算容易，反向计算困难。
### 示例：
- **因式分解**：pq = N，已知N求p、q，正向计算容易（已知p、q计算N），反向计算困难（已知N求p、q）。
- **离散对数**：a<sup>b</sup> mod c = N，已知a、c、N求b，正向计算（已知a、b、c计算a<sup>b</sup> mod c ）容易，反向计算困难。
- **输入→函数→哈希→输出**：正向计算容易，反向计算几乎不可能。
## 更多术语
- 单向函数：1958年拉宾解决麦卡锡问题时用到，如平方取中、指数运算等。
- [单向]哈希函数：也称为消息摘要、指纹、加密校验和、完整性校验。
- 加密哈希。
- 消息认证码：只有拥有密钥的人才能验证消息。
## 更多术语
- **流密码**：一次加密一个字符。
- **分组密码**：一次加密一个数据块。
- **数字签名**：用于验证消息的真实性，而非加密消息。使用一对密钥（私钥、公钥），消息所有者用私钥加密消息，发送方用公钥解密验证。通常使用消息的哈希值。
## 大纲
- 密码学简介
- 古典密码
- 计算机密码学
## 密码学的用途
- **认证**：确定消息的来源。
- **完整性**：验证消息未被修改。
- **不可否认性**：发送者不能虚假否认发送过消息。
- **保密性**：其他人无法读取消息内容。
## 凯撒密码
最早有文献记载的军事加密应用：
- 公元前60年左右，由尤利乌斯·凯撒使用。
- 移位密码，是替换密码的一种简单变体。每个字母被替换为字母表中向后移动n个位置的字母（模字母表大小）。
n = 移位值 = 密钥
- 类似的加密方案在印度也有使用，早期印度人还使用基于语音的替换加密，类似于儿童文字游戏“猪拉丁语”。
- 后来在新闻组中，ROT13（一种特殊的凯撒密码，移位值为13）被用于避免读者无意中看到冒犯性消息。
## 凯撒密码
![凯撒密码图1](https://i.imgur.com/xxxxxx.png)
## 凯撒密码
![凯撒密码图2](https://i.imgur.com/xxxxxx.png)
（将字母表按n（此处为6）个位置移位）
## 凯撒密码
原文：MY CAT HAS FLEAS
## 凯撒密码
原文：MY CAT HAS FLEAS
加密过程：
M对应G
## 凯撒密码
原文：MY CAT HAS FLEAS
加密过程：
MY对应GS
## 凯撒密码
原文：MY CAT HAS FLEAS
加密过程：
MY C对应GSW
## 凯撒密码
原文：MY CAT HAS FLEAS
加密过程：
MY CA对应GSWU
## 凯撒密码
原文：MY CAT HAS FLEAS
加密过程：
MY CAT对应GSWUN
## 凯撒密码
原文：MY CAT HAS FLEAS
加密过程：
MY CATH对应GSWUNB
## 凯撒密码
原文：MY CAT HAS FLEAS
加密过程：
MY CAT HA对应GSWUNBU
## 凯撒密码
原文：MY CAT HAS FLEAS
加密过程：
MY CAT HAS对应GSWUNBUM
## 凯撒密码
原文：MY CAT HAS FLEAS
加密过程：
MY CAT HAS F对应GSWUNBUMZ
## 凯撒密码
原文：MY CAT HAS FLEAS
加密过程：
MY CAT HAS FL对应GSWUNBUMZF
## 凯撒密码
原文：MY CAT HAS FLEAS
加密过程：
MY CAT HAS FLE对应GSWUNBUMZFY
## 凯撒密码
原文：MY CAT HAS FLEAS
加密过程：
MY CAT HAS FLEA对应GSWUNBUMZFYU
## 凯撒密码
原文：MY CAT HAS FLEAS
加密过程：
MY CAT HAS FLEAS对应GSWUNBMUFZYUM
- 解密时需要知道移位值这一信息。
- 很容易破解（对于26个字符的字母表，只有26种可能的移位值）。
## 古代希伯来变体（ATBASH密码）
原文：MY CAT HAS FLEAS
加密后：NBXZGSZHUOVZH
- 大约公元前600年。
- 无需传递任何信息（密钥）！
## 替换密码
原文：MY CAT HAS FLEAS
加密后：IVSMXAMBQCLMB
- 一般情况：任意映射。通信双方都必须有替换字母表。
## 替换密码
容易被破解：易受频率分析攻击。
| 《白鲸记》（120万个字符） | 莎士比亚作品（5580万个字符） |
| --- | --- |
| e：12.300% | e：11.797% |
| o：7.282% | o：8.299% |
| d：4.015% | d：3.943% |
| b：1.773% | b：1.634% |
| x：0.108% | x：0.140% |
《哈姆雷特的悲剧历史》（*THE Tragicall Hitoric of H'AMLET*）
## 统计分析
### 字母频率
- E：12%。
- A、H、I、N、O、R、S、T：6 - 9%。
- 强密码：至少12个字符长，14个或更多更好，且包含大写字母、小写字母、数字和符号的组合。
- D、L：4%。
- B、C、F、G、M、P、U、W、Y：1.5 - 2.8%。
- J、K、Q、V、X、Z：< 1%。
### 常见双字母组合
TH、HE、IN、ER、AN、RE等。
### 常见三字母组合
THE、ING、AND、HER、ERE等。
## 大纲
- 密码学简介
- 古典密码
- 计算机密码学
## 数据加密标准（DES）
- 1976年被采纳为联邦标准。
- 分组密码，处理64位数据块。
- 使用56位密钥，安全性完全依赖于密钥。
- 先进行替换操作，再进行置换（换位）操作，对每个明文数据块重复应用这组技术16次。
## DES加密流程
![DES加密流程](https://i.imgur.com/xxxxxx.png)
64位明文数据块，48位子密钥（由主密钥置换得到），经过初始置换（IP），分为左半部分L0和右半部分R0，经过16轮运算（每轮使用不同的子密钥K<sub>i</sub>），最后经过最终置换（IP<sup>-1</sup>）得到64位密文数据块。
## DES的f函数
DATA：右侧32位数据
KEY：56位密钥
经过一系列运算后，48位结果通过8个替换盒（S盒）进行替换操作，最终生成新的右侧32位数据。
## DES的S盒
- 压缩后的密钥与扩展后的数据块进行异或运算。
- 48位结果通过8个替换盒（S盒）进行替换操作。
- 每个S盒：
    - 6位输入。
    - 4位输出。
    - 48位数据被分为8个6位子块，每个子块由一个单独的S盒处理。
    - S盒是DES安全性的关键组成部分。
    - 最终结果：48位输入生成32位输出。
## DES安全吗？
56位密钥使得DES相对较弱，共有7.2×10¹⁶个密钥。
### 暴力攻击
20世纪90年代后期：
- 制造出了DES破解机器，能在几小时内破解DES密钥。
- DES Deep Crack：每秒可测试900亿个密钥。
- Distributed.net：每秒可测试2500亿个密钥。
## 2的幂次方的影响
密钥增加一位，搜索空间翻倍。
假设破解一个20位密钥需要1秒：
- 21位密钥：2秒。
- 32位密钥：1小时。
- 40位密钥：12天。
- 56位密钥：2178年。
- 64位密钥：超过55.7万年！
## 增加密钥长度
双重加密对DES有效吗？
如果能找到一个密钥K，使得E<sub>K</sub>(P) = E<sub>K2</sub>(E<sub>K1</sub>(P))，那么双重加密就没有意义。但DES不存在这样的情况。
## 双重DES
容易受到中间人攻击。如果知道某对明文和密文（P, C），则：
[1] 用所有2⁵⁶个可能的K₁值对P进行加密。
[2] 用所有2⁵⁶个可能的K₂值对C进行解密。
对于每一个匹配结果（[1] = [2]）：
- 用另一对P, C测试这两个密钥。
- 如果匹配，则确定找到了正确的密钥。
## 三重DES
使用两个56位密钥的三重DES：
C = E<sub>K1</sub>(D<sub>K2</sub>(E<sub>K1</sub>(P)))
使用三个56位密钥的三重DES：
C = E<sub>K3</sub>(D<sub>K2</sub>(E<sub>K1</sub>(P)))
中间步骤使用解密操作是为了与DES兼容（当K₁ = K₂ = K₃ = k时，C = E<sub>K</sub>(D<sub>K</sub>(E<sub>K</sub>(P)))等同于C = E<sub>K1</sub>(P)）。
## 三重DES
通过三个阶段和两个密钥防止中间人攻击。
三重DES：
C = E<sub>K1</sub>(D<sub>K2</sub>(E<sub>K1</sub>(P)))
中间步骤使用解密操作是为了与DES兼容（当K₁ = K₂ = K₃ = k时，C = E<sub>K</sub>(D<sub>K</sub>(E<sub>K</sub>(P)))等同于C = E<sub>K1</sub>(P)）。
## 流行的对称算法
- **国际数据加密算法（IDEA）**：1992年提出，使用128位密钥，处理8字节数据块（类似DES），比DES更安全。
- **RC4算法（由罗恩·李维斯特开发）**：1995年发布，密钥长度最长可达2048位，但用相同密钥加密多个消息时不安全。
- **高级加密标准（AES）**：美国国家标准与技术研究院（NIST）选定的DES替代算法，2000年10月确定，基于Rijndael密码，支持128位、192位和256位密钥。
## AES
美国国家标准与技术研究院（NIST）数据显示：假设能制造一台每秒可破解一个DES密钥（即每秒尝试2⁵⁶个密钥）的机器，那么破解一个128位的AES密钥大约需要149万亿年。相比之下，宇宙的年龄据信不到200亿年。
来源：http://csrc.nist.gov/encryption/aes/
## 对称加密
- 通信双方必须就一个秘密密钥K达成一致，消息被加密后发送，接收方用相同密钥解密。
- 密钥分发必须保密，否则消息可能被解密，用户可能被冒充。
## 密钥数量爆炸
每对用户需要一个单独的密钥来进行安全通信。
| 用户数量 | 密钥数量 |
| --- | --- |
| 2 | 1 |
| 3 | 3 |
| 4 | 6 |
| 6 | 15 |
| 100 | 4950 |
| 1000 | 399500 |
| n | \(\frac{n(n - 1)}{2}\) |
## 密钥分发
安全的密钥分发是对称加密最大的问题。如何与从未见过面的人进行安全通信？
惠特·迪菲提出了公钥算法的构想。挑战：能否安全地实现这一构想？公钥的信息不应泄露私钥的信息。
## 迪菲 - 赫尔曼指数密钥交换（密钥分发算法）
- 第一个使用公钥/私钥的算法，但不是公钥加密算法。
- 基于在有限域中计算离散对数的困难性（相比之下，计算指数运算较为容易）。
- 允许双方在不担心被窃听的情况下协商出一个秘密会话密钥。
## 迪菲 - 赫尔曼指数密钥交换
- 所有运算在模一个大整数的整数域中进行。
- 双方需要商定：
    - 一个大素数p。
    - 一个小于p的数α。
- 双方各自生成一对公钥/私钥：用户i的私钥为X<sub>i</sub>，公钥为Y<sub>i</sub> = α<sup>X<sub>i</sub></sup> mod p。
## 迪菲 - 赫尔曼指数密钥交换
- 爱丽丝有私钥X<sub>A</sub>和公钥Y<sub>A</sub>，计算K = Y<sub>B</sub><sup>X<sub>A</sub></sup> mod p。
- 鲍勃有私钥X<sub>B</sub>和公钥Y<sub>B</sub>，计算
